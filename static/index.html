<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinchy - 脚本调度执行系统</title>
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">
    <link rel="stylesheet" href="/static/css/tailwind.min.css">
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">

    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>
</head>
<body class="bg-gray-100 font-sans theme-blue" x-data="app()" x-init="init()">
    <!-- Toast 容器 -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col space-y-3 pointer-events-none">
        <template x-for="toast in toasts" :key="toast.id">
            <div :class="'toast p-4 rounded-lg shadow-lg text-white max-w-sm pointer-events-auto ' + (toast.type === 'success' ? 'bg-green-500' : toast.type === 'error' ? 'bg-red-500' : toast.type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500')"
                 x-show="toast.show"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-x-full scale-95"
                 x-transition:enter-end="opacity-100 transform translate-x-0 scale-100"
                 x-transition:leave="transition ease-in duration-300"
                 x-transition:leave-start="opacity-100 transform translate-x-0 scale-100"
                 x-transition:leave-end="opacity-0 transform translate-x-full scale-95">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i :class="'mr-2 ' + (toast.type === 'success' ? 'fas fa-check-circle' : toast.type === 'error' ? 'fas fa-exclamation-circle' : toast.type === 'warning' ? 'fas fa-exclamation-triangle' : 'fas fa-info-circle')"></i>
                        <span x-text="toast.message"></span>
                    </div>
                    <button @click="removeToast(toast.id)" class="ml-4 text-white hover:text-gray-200 flex-shrink-0">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </template>
    </div>

    <!-- 登录页面 -->
    <div x-show="!isAuthenticated" x-cloak class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50">
        <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-md w-full">
                <!-- 登录卡片 -->
                <div class="bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden">
                    <!-- 头部装饰 -->
                    <div class="h-2 bg-gradient-to-r from-blue-500 to-indigo-600"></div>

                    <!-- 登录内容 -->
                    <div class="px-8 py-10">
                        <!-- Logo和标题 -->
                        <div class="text-center mb-8">
                            <div class="flex items-center justify-center mb-4">
                                <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg">
                                    <img src="/static/images/logo.jpg" alt="Pinchy Logo" class="w-10 h-10 rounded-lg">
                                </div>
                            </div>
                            <h2 class="text-3xl font-bold text-gray-900 mb-2">欢迎回来</h2>
                            <p class="text-gray-600">登录到 Pinchy 脚本调度管理系统</p>
                        </div>

                        <!-- 登录表单 -->
                        <form @submit.prevent="login()" class="space-y-6">
                            <div class="space-y-4">
                                <div>
                                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">用户名</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-user text-gray-400"></i>
                                        </div>
                                        <input id="username" name="username" type="text" required
                                               class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                               placeholder="请输入用户名" x-model="loginForm.username">
                                    </div>
                                </div>
                                <div>
                                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">密码</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-lock text-gray-400"></i>
                                        </div>
                                        <input id="password" name="password" type="password" required
                                               class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                               placeholder="请输入密码" x-model="loginForm.password">
                                    </div>
                                </div>

                                <!-- 验证码 -->
                                <div x-show="securityStatus.show_captcha">
                                    <label for="captcha" class="block text-sm font-medium text-gray-700 mb-2">验证码</label>
                                    <div class="flex space-x-3">
                                        <div class="flex-1">
                                            <input id="captcha" name="captcha" type="text"
                                                   class="block w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                                   placeholder="请输入验证码答案" x-model="loginForm.captcha_answer">
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-32 h-12 border border-gray-300 rounded-lg overflow-hidden bg-white flex items-center justify-center cursor-pointer"
                                                 @click="refreshCaptcha()">
                                                <img x-show="captchaImage" :src="captchaImage" alt="验证码" class="max-w-full max-h-full">
                                                <span x-show="!captchaImage" class="text-xs text-gray-400">点击获取</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 多因素认证 -->
                                <div x-show="securityStatus.mfa_enabled">
                                    <label for="mfa_code" class="block text-sm font-medium text-gray-700 mb-2">验证码</label>
                                    <div class="flex space-x-3">
                                        <div class="flex-1">
                                            <input id="mfa_code" name="mfa_code" type="text" maxlength="6"
                                                   class="block w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                                   placeholder="请输入6位验证码" x-model="loginForm.mfa_code">
                                        </div>
                                        <div class="flex-shrink-0">
                                            <button type="button" @click="sendMFACode()" :disabled="mfaCodeSending || mfaCodeCooldown > 0"
                                                    class="px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg text-sm font-medium transition-colors">
                                                <span x-show="!mfaCodeSending && mfaCodeCooldown === 0">发送</span>
                                                <span x-show="mfaCodeSending">发送中...</span>
                                                <span x-show="!mfaCodeSending && mfaCodeCooldown > 0" x-text="mfaCodeCooldown + 's'"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" :disabled="loading"
                                    class="w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-lg text-white btn-primary disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-medium">
                                <span x-show="!loading">立即登录</span>
                                <span x-show="loading" class="flex items-center">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    登录中...
                                </span>
                            </button>
                        </form>

                        <!-- 用户协议 -->
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <p class="text-xs text-gray-500 text-center">
                                登录即表示您同意我们的
                                <button @click="showAgreementModal = true" class="link-primary underline">
                                    用户协议
                                </button>
                                和
                                <button @click="showTermsModal = true" class="link-primary underline">
                                    服务条款
                                </button>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 底部信息 -->
                <div class="text-center mt-8">
                    <p class="text-sm text-gray-500">
                        © 2025 Pinchy. Python/Node.JS脚本调度执行系统
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 主界面 -->
    <div x-show="isAuthenticated" x-cloak class="flex h-screen bg-gray-100">
        <!-- 移动端遮罩层 -->
        <div x-show="mobileMenuOpen" @click="mobileMenuOpen = false"
             class="fixed inset-0 z-40 bg-black bg-opacity-50 md:hidden"
             x-transition:enter="transition-opacity ease-linear duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity ease-linear duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"></div>

        <!-- 侧边栏 -->
        <div class="sidebar w-64 bg-white shadow-lg md:relative md:translate-x-0"
             :class="mobileMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'"
             style="transition: transform 0.3s ease-in-out;">
            <div class="flex items-center justify-center h-16 theme-primary-bg theme-primary-hover text-white relative">
                <img src="/static/images/logo.jpg" alt="Pinchy Logo" class="w-8 h-8 mr-2 rounded">
                <h1 class="text-xl font-bold">Pinchy</h1>
                <div class="absolute bottom-1 right-2 text-xs opacity-75" x-text="systemVersion"></div>
            </div>
            <nav class="mt-8">
                <a href="#" @click="switchPage('dashboard')"
                   :class="currentPage === 'dashboard' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-tachometer-alt w-4 text-center mr-3"></i>
                    仪表板
                </a>
                <a href="#" @click="switchPage('tasks')"
                   :class="currentPage === 'tasks' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-tasks w-4 text-center mr-3"></i>
                    任务管理
                </a>
                <a href="#" @click="switchPage('files')"
                   :class="currentPage === 'files' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-folder w-4 text-center mr-3"></i>
                    文件管理
                </a>
                <a href="#" @click="switchPage('logs')"
                   :class="currentPage === 'logs' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-list-alt w-4 text-center mr-3"></i>
                    执行日志
                </a>
                <a href="#" @click="switchPage('subscriptions')"
                   :class="currentPage === 'subscriptions' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-download w-4 text-center mr-3"></i>
                    脚本订阅
                </a>
                <a href="#" @click="switchPage('env')"
                   :class="currentPage === 'env' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-cog w-4 text-center mr-3"></i>
                    环境变量
                </a>
                <a href="#" @click="switchPage('packages')"
                   :class="currentPage === 'packages' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-box w-4 text-center mr-3"></i>
                    包管理
                </a>
                <a href="#" @click="switchPage('notifications')"
                   :class="currentPage === 'notifications' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-bell w-4 text-center mr-3"></i>
                    通知服务
                </a>
                <a href="#" @click="switchPage('api-debug')"
                   :class="currentPage === 'api-debug' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-bug w-4 text-center mr-3"></i>
                    接口调试
                </a>
                <a href="#" @click="switchPage('settings')"
                   :class="currentPage === 'settings' ? 'theme-primary-bg-light border-r-4 theme-primary-border theme-primary-text' : 'text-gray-600 hover:bg-gray-50'"
                   class="flex items-center px-6 py-3 text-sm font-medium">
                    <i class="fas fa-cogs w-4 text-center mr-3"></i>
                    系统设置
                </a>
            </nav>
            <div class="absolute bottom-0 w-64 p-4 border-t">
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-600" x-text="user ? '欢迎, ' + user.username : '加载中...'"></span>
                    <button @click="logout()" class="text-sm text-red-600 hover:text-red-800">
                        <i class="fas fa-sign-out-alt mr-1"></i>
                        登出
                    </button>
                </div>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- 顶部栏 -->
            <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="flex items-center justify-between px-4 md:px-6 py-4">
                    <div class="flex items-center">
                        <!-- 移动端菜单按钮 -->
                        <button @click="mobileMenuOpen = !mobileMenuOpen" class="mr-4 md:hidden text-gray-600 hover:text-gray-900">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h2 class="text-lg md:text-xl font-semibold text-gray-800" x-text="getPageTitle()"></h2>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center text-sm text-gray-600 group relative">
                            <div :class="wsConnected ? 'bg-green-400' : 'bg-red-400'" class="w-2 h-2 rounded-full mr-2"></div>
                            <span class="hidden sm:inline">
                                <i :class="wsConnected ? 'fas fa-satellite-dish' : 'fas satellite-dish'"></i>
                                <span x-text="wsConnected ? '已连接' : '未连接'"></span>
                            </span>
                            <div class="sm:hidden" :class="wsConnected ? 'text-green-600' : 'text-red-600'">
                                <i :class="wsConnected ? 'fas fa-satellite-dish' : 'fas fa-satellite'"></i>
                            </div>
        
                            <!-- 悬停提示框 -->
                            <div class="absolute hidden group-hover:block top-full left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap mt-1">
                                <span x-text="wsConnected ? '服务已连接' : '服务断开'"></span>
                                <div class="absolute w-2 h-2 bg-gray-800 transform rotate-45 -top-1 left-1/2 -translate-x-1/2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 页面内容 -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-4 md:p-6">
                <!-- 仪表板页面 -->
                <div x-show="currentPage === 'dashboard'" x-cloak>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i class="fas fa-tasks text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">总任务数</p>
                                    <p class="text-2xl font-semibold text-gray-900" x-text="stats.totalTasks"></p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i class="fas fa-check-circle text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">活跃任务</p>
                                    <p class="text-2xl font-semibold text-gray-900" x-text="stats.activeTasks"></p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                    <i class="fas fa-clock text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">今日执行</p>
                                    <p class="text-2xl font-semibold text-gray-900" x-text="stats.todayExecutions"></p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-red-100 text-red-600">
                                    <i class="fas fa-exclamation-triangle text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">失败任务</p>
                                    <p class="text-2xl font-semibold text-gray-900" x-text="stats.failedTasks"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 最近日志 -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">最近执行日志</h3>
                        </div>
                        <div class="p-6">
                            <div x-show="dashboardLoading" class="text-center text-gray-500 py-8">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                加载中...
                            </div>
                            <div x-show="!dashboardLoading && recentLogs.length === 0" class="text-center text-gray-500 py-8">
                                暂无执行日志
                            </div>
                            <div x-show="!dashboardLoading && recentLogs.length > 0" class="space-y-4">
                                <template x-for="log in recentLogs" :key="log.id">
                                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                        <div class="flex items-center">
                                            <div :class="'w-3 h-3 rounded-full mr-3 ' + (log.status === 'success' ? 'bg-green-400' : log.status === 'failed' ? 'bg-red-400' : 'bg-yellow-400')"></div>
                                            <div>
                                                <p class="font-medium text-gray-900" x-text="log.task_name"></p>
                                                <p class="text-sm text-gray-600" x-text="formatDateTime(log.start_time)"></p>
                                            </div>
                                        </div>
                                        <span :class="'px-2 py-1 text-xs font-medium rounded-full ' + (log.status === 'success' ? 'bg-green-100 text-green-800' : log.status === 'failed' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800')" 
                                              x-text="getStatusText(log.status)"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 任务管理页面 -->
                <div x-show="currentPage === 'tasks'" x-cloak>
                    <div class="mb-6 flex gap-3">
                        <button @click="showTaskModal = true; editingTask = null; resetTaskForm()"
                                class="btn-primary text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i>
                            创建任务
                        </button>
                        <button @click="refreshTaskData()"
                                class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>
                            刷新列表
                        </button>
                    </div>

                    <!-- 任务分组标签 -->
                    <div class="bg-white rounded-lg shadow mb-4" @click.away="closeGroupDropdown()">
                        <div class="px-6 py-4">
                            <div class="flex gap-2 overflow-x-auto pb-2" style="scrollbar-width: thin; scrollbar-color: #cbd5e0 #f7fafc;">
                                <style>
                                    .flex.gap-2.overflow-x-auto::-webkit-scrollbar {
                                        height: 4px;
                                    }
                                    .flex.gap-2.overflow-x-auto::-webkit-scrollbar-track {
                                        background: #f7fafc;
                                        border-radius: 2px;
                                    }
                                    .flex.gap-2.overflow-x-auto::-webkit-scrollbar-thumb {
                                        background: #cbd5e0;
                                        border-radius: 2px;
                                    }
                                    .flex.gap-2.overflow-x-auto::-webkit-scrollbar-thumb:hover {
                                        background: #a0aec0;
                                    }
                                </style>
                                <button @click="switchTaskGroup('all')"
                                        :class="currentTaskGroup === 'all' ? 'btn-primary text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'"
                                        class="px-4 py-2 text-sm font-medium transition-colors whitespace-nowrap">
                                    全部 (<span x-text="taskPagination.total"></span>)
                                </button>
                                <template x-for="group in taskGroups" :key="group">
                                    <div class="relative">
                                        <div class="flex items-center">
                                            <button @click="switchTaskGroup(group)"
                                                    :class="currentTaskGroup === group ? 'btn-primary text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'"
                                                    class="px-4 py-2 text-sm font-medium transition-colors whitespace-nowrap"
                                                    x-text="group">
                                            </button>
                                            <button @click="toggleGroupDropdown(group, $event)"
                                                    :class="currentTaskGroup === group ? 'btn-primary text-white hover:opacity-90' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'"
                                                    class="px-2 py-2 text-sm transition-colors border-l border-gray-300"
                                                    :id="'group-dropdown-btn-' + group">
                                                <i class="fas fa-chevron-down text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- 任务列表 -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-medium text-gray-900">
                                任务列表
                                <span x-show="currentTaskGroup && currentTaskGroup !== 'all'"
                                      class="text-sm text-gray-500 ml-2">
                                    - <span x-text="currentTaskGroup"></span>
                                </span>
                            </h3>
                            <div class="text-sm text-gray-500">
                                共 <span x-text="taskPagination.total"></span> 个任务
                            </div>
                        </div>
                        <div x-show="tasksLoading" class="text-center py-8 text-gray-500">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            加载中...
                        </div>
                        <div x-show="!tasksLoading" class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">任务名称</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">脚本类型</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cron表达式</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">上次运行</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">下次运行</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="task in tasks" :key="task.id">
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div>
                                                    <div class="text-sm font-medium text-gray-900" x-text="task.name"></div>
                                                    <div class="text-sm text-gray-500">
                                                        <span x-show="!task.description || task.description.length <= 10"
                                                              x-text="task.description || '无描述'"></span>
                                                        <span x-show="task.description && task.description.length > 10"
                                                              :title="task.description"
                                                              class="cursor-help"
                                                              x-text="task.description.substring(0, 10) + '...'"></span>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                                      :class="task.script_type === 'python' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'">
                                                    <i :class="task.script_type === 'python' ? 'fab fa-python' : 'fab fa-js-square'" class="mr-1"></i>
                                                    <span x-text="task.script_type"></span>
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="task.cron_expression"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <label class="relative inline-flex items-center cursor-pointer">
                                                        <input type="checkbox" :checked="task.is_active" @change="toggleTask(task)" class="sr-only peer">
                                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                    </label>

                                                    <!-- 运行状态图标 -->
                                                    <div x-show="runningTasks.has(task.id)"
                                                         class="ml-3"
                                                         title="任务正在运行">
                                                        <i class="fas fa-spinner fa-spin text-blue-500"></i>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="getTaskLastRunTime(task.id)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="getTaskNextRunTime(task)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <!-- 运行/停止按钮 -->
                                                <button x-show="!runningTasks.has(task.id)"
                                                        @click="runTask(task)"
                                                        class="link-primary">运行</button>
                                                <button x-show="runningTasks.has(task.id)"
                                                        @click="showStopTaskModal(task)"
                                                        class="link-primary">停止</button>

                                                <button @click="viewTaskLogs(task)" class="link-primary">日志</button>
                                                <button @click="editTask(task)" class="link-primary">编辑</button>
                                                <button @click="deleteTask(task)" class="link-primary">删除</button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                            <div x-show="tasks.length === 0" class="text-center py-8 text-gray-500">
                                暂无任务
                            </div>
                        </div>

                        <!-- 分页组件 -->
                        <div x-show="taskPagination.totalPages > 1" class="px-6 py-4 border-t border-gray-200">
                            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                                <!-- 分页信息 -->
                                <div class="text-sm text-gray-700">
                                    显示第 <span x-text="(taskPagination.page - 1) * taskPagination.pageSize + 1"></span>
                                    到 <span x-text="Math.min(taskPagination.page * taskPagination.pageSize, taskPagination.total)"></span>
                                    条，共 <span x-text="taskPagination.total"></span> 条记录
                                </div>

                                <!-- 分页按钮 -->
                                <div class="flex items-center space-x-2">
                                    <!-- 上一页 -->
                                    <button @click="goToTaskPage(taskPagination.page - 1)"
                                            :disabled="taskPagination.page <= 1"
                                            :class="taskPagination.page <= 1 ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'"
                                            class="px-3 py-2 text-white rounded-lg text-sm">
                                        上一页
                                    </button>

                                    <!-- 页码按钮 -->
                                    <template x-for="page in Array.from({length: Math.min(5, taskPagination.totalPages)}, (_, i) => {
                                        const start = Math.max(1, taskPagination.page - 2);
                                        const end = Math.min(taskPagination.totalPages, start + 4);
                                        const adjustedStart = Math.max(1, end - 4);
                                        return adjustedStart + i;
                                    }).filter(p => p <= taskPagination.totalPages)" :key="page">
                                        <button @click="goToTaskPage(page)"
                                                :class="page === taskPagination.page ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'"
                                                class="px-3 py-2 rounded-lg text-sm"
                                                x-text="page">
                                        </button>
                                    </template>

                                    <!-- 下一页 -->
                                    <button @click="goToTaskPage(taskPagination.page + 1)"
                                            :disabled="taskPagination.page >= taskPagination.totalPages"
                                            :class="taskPagination.page >= taskPagination.totalPages ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'"
                                            class="px-3 py-2 text-white rounded-lg text-sm">
                                        下一页
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 文件管理页面 -->
                <div x-show="currentPage === 'files'" x-cloak>
                    <!-- 普通文件管理模式 -->
                    <div x-show="!debugMode.active">
                        <div class="mb-6 flex flex-col sm:flex-row gap-4">
                        <button @click="showUploadModal = true"
                                class="btn-primary text-white px-4 py-2 rounded-lg flex items-center justify-center">
                            <i class="fas fa-upload mr-2"></i>
                            上传文件
                        </button>
                        <button @click="showCreateTextModal = true"
                                class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center justify-center">
                            <i class="fas fa-file-alt mr-2"></i>
                            新建文本
                        </button>
                        <button @click="showCreateDirModal = true"
                                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center justify-center">
                            <i class="fas fa-folder-plus mr-2"></i>
                            创建目录
                        </button>
                        <button x-show="currentPath" @click="goToParentDirectory()"
                                class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center justify-center">
                            <i class="fas fa-arrow-up mr-2"></i>
                            返回上级
                        </button>
                    </div>

                    <!-- 路径导航 -->
                    <div x-show="currentPath" class="mb-4">
                        <nav class="flex" aria-label="Breadcrumb">
                            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                                <li class="inline-flex items-center">
                                    <button @click="navigateToPath('')" class="link-primary">
                                        <i class="fas fa-home mr-1"></i>
                                        根目录
                                    </button>
                                </li>
                                <template x-for="(part, index) in getPathParts()" :key="index">
                                    <li>
                                        <div class="flex items-center">
                                            <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                                            <button @click="navigateToPath(getPathUpTo(index))"
                                                    class="link-primary" x-text="part"></button>
                                        </div>
                                    </li>
                                </template>
                            </ol>
                        </nav>
                    </div>

                    <!-- 文件列表 -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">文件管理</h3>
                            <div x-show="!filesLoading && files.length > 0" class="text-sm text-gray-500">
                                共 <span x-text="files.length"></span> 项
                            </div>
                        </div>
                        <div x-show="filesLoading" class="text-center text-gray-500 py-8">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            加载中...
                        </div>
                        <div x-show="!filesLoading && files.length === 0" class="text-center text-gray-500 py-8">
                            目录为空
                        </div>
                        <div x-show="!filesLoading && files.length > 0" class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">名称</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">大小</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">修改时间</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-64">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="file in files" :key="file.path">
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="mr-3">
                                                        <i x-show="file.is_directory" class="fas fa-folder text-blue-500 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'python'" class="fab fa-python text-blue-600 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'javascript'" class="fab fa-js-square text-yellow-500 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'code'" class="fas fa-file-code text-green-600 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'markdown'" class="fab fa-markdown text-purple-600 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'text'" class="fas fa-file-alt text-gray-600 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'cog'" class="fas fa-cog text-gray-700 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'archive'" class="fas fa-file-archive text-orange-500 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'file-alt'" class="fas fa-file-alt text-blue-500 text-lg"></i>
                                                        <i x-show="!file.is_directory && getFileIcon(file.name) === 'file'" class="fas fa-file text-gray-500 text-lg"></i>
                                                    </div>
                                                    <div class="text-sm font-medium text-gray-900">
                                                        <div class="flex items-center space-x-2">
                                                            <button x-show="file.is_directory" @click="enterDirectory(file.path)"
                                                                    class="text-blue-600 hover:text-blue-900 hover:underline text-left"
                                                                    x-text="file.name"></button>
                                                            <span x-show="!file.is_directory" x-text="file.name"></span>
                                                            <!-- 调试按钮 -->
                                                            <button x-show="!file.is_directory && (file.name.endsWith('.py') || file.name.endsWith('.js'))"
                                                                    @click="startDebugScript(file)"
                                                                    class="link-primary hover:text-blue-900 text-xs px-2 py-1 rounded border border-blue-200 hover:border-blue-300"
                                                                    title="调试脚本">
                                                                <i class="fas fa-bug mr-1"></i>调试
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <span x-show="!file.is_directory" x-text="formatFileSize(file.size)"></span>
                                                <span x-show="file.is_directory" class="text-gray-400">--</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDateTime(file.modified_time * 1000)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <div class="grid grid-cols-6 gap-1 w-48">
                                                    <!-- 打开目录/解压文件 -->
                                                    <div class="flex justify-center">
                                                        <button x-show="file.is_directory" @click="enterDirectory(file.path)"
                                                                class="link-primary text-xs px-1 py-1 rounded hover:bg-blue-50 min-w-[2rem]">
                                                            打开
                                                        </button>
                                                        <button x-show="!file.is_directory && isArchiveFile(file.name)"
                                                                @click="startExtract(file)"
                                                                class="link-primary text-xs px-1 py-1 rounded hover:bg-blue-50 min-w-[2rem]">
                                                            解压
                                                        </button>
                                                    </div>
                                                    <!-- 预览文件 -->
                                                    <div class="flex justify-center">
                                                        <button x-show="!file.is_directory && isTextFile(file.name)" @click="previewFile(file)"
                                                                class="link-primary text-xs px-1 py-1 rounded hover:bg-blue-50 min-w-[2rem]">
                                                            预览
                                                        </button>
                                                    </div>
                                                    <!-- 复制路径 -->
                                                    <div class="flex justify-center">
                                                        <button x-show="!file.is_directory && (file.name.endsWith('.py') || file.name.endsWith('.js'))"
                                                                @click="copyFilePath(file.path)"
                                                                class="link-primary text-xs px-1 py-1 rounded hover:bg-blue-50 min-w-[2rem]">
                                                            复制
                                                        </button>
                                                    </div>
                                                    <!-- 重命名 -->
                                                    <div class="flex justify-center">
                                                        <button @click="startRename(file)"
                                                                class="link-primary text-xs px-1 py-1 rounded hover:bg-blue-50 min-w-[2rem]">
                                                            更名
                                                        </button>
                                                    </div>
                                                    <!-- 下载文件 -->
                                                    <div class="flex justify-center">
                                                        <button x-show="!file.is_directory" @click="downloadFile(file.path)"
                                                                class="link-primary text-xs px-1 py-1 rounded hover:bg-blue-50 min-w-[2rem]">
                                                            下载
                                                        </button>
                                                    </div>
                                                    <!-- 删除 -->
                                                    <div class="flex justify-center">
                                                        <button @click="deleteFile(file)"
                                                                class="link-primary text-xs px-1 py-1 rounded hover:bg-blue-50 min-w-[2rem]">
                                                            删除
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>

                    <!-- 脚本调试模式 -->
                    <div x-show="debugMode.active">
                        <!-- 调试工具栏 -->
                        <div class="mb-6 flex flex-col sm:flex-row gap-4 items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <h2 class="text-xl font-semibold text-gray-900">
                                    <i class="fas fa-bug mr-2"></i>
                                    脚本调试: <span x-text="debugMode.scriptName"></span>
                                </h2>
                                <span x-show="debugMode.status !== 'idle'"
                                      :class="debugMode.status === 'running' ? 'bg-green-100 text-green-800' :
                                             debugMode.status === 'completed' ? 'bg-blue-100 text-blue-800' :
                                             debugMode.status === 'error' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'"
                                      class="inline-flex px-2 py-1 text-xs font-semibold rounded-full">
                                    <span x-text="debugMode.status === 'running' ? '运行中' :
                                                 debugMode.status === 'completed' ? '已完成' :
                                                 debugMode.status === 'error' ? '错误' : ''"></span>
                                </span>
                            </div>
                            <div class="flex space-x-3">
                                <button @click="saveDebugScript()"
                                        :disabled="debugMode.saving"
                                        class="btn-primary text-white px-4 py-2 rounded-lg flex items-center">
                                    <i class="fas fa-save mr-2"></i>
                                    <span x-text="debugMode.saving ? '保存中...' : '保存文件'"></span>
                                </button>
                                <button @click="runDebugScript()"
                                        :disabled="debugMode.running"
                                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i class="fas fa-play mr-2"></i>
                                    <span x-text="debugMode.running ? '运行中...' : '运行脚本'"></span>
                                </button>
                                <button @click="closeDebugMode()"
                                        class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i class="fas fa-times mr-2"></i>
                                    关闭调试
                                </button>
                            </div>
                        </div>

                        <!-- 调试内容区域 -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" style="height: calc(100vh - 160px)">
                            <!-- 左侧：代码编辑器 -->
                            <div class="bg-white rounded-lg shadow flex flex-col">
                                <div class="px-6 py-4 border-b border-gray-200 flex-shrink-0">
                                    <h3 class="text-lg font-medium text-gray-900">代码编辑器</h3>
                                </div>
                                <div class="p-4 flex-1 min-h-0">
                                    <div id="code-editor"
                                         class="w-full h-full border border-gray-300 rounded-md overflow-hidden"
                                         style="height: calc(100vh - 280px); max-height: calc(100vh - 280px);">
                                    </div>
                                </div>
                            </div>

                            <!-- 右侧：输出区域 -->
                            <div class="bg-white rounded-lg shadow flex flex-col">
                                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between flex-shrink-0">
                                    <h3 class="text-lg font-medium text-gray-900">输出信息</h3>
                                    <button @click="clearDebugOutput()"
                                            class="text-gray-500 hover:text-gray-700 text-sm">
                                        <i class="fas fa-trash mr-1"></i>
                                        清空
                                    </button>
                                </div>
                                <div class="p-4 flex-1 min-h-0">
                                    <div class="bg-black text-green-400 font-mono text-sm p-3 rounded-md overflow-y-auto"
                                         style="height: calc(100vh - 280px); max-height: calc(100vh - 280px);"
                                         x-ref="debugOutput">
                                        <div x-show="debugMode.output.length === 0" class="text-gray-500">
                                            等待脚本输出...
                                        </div>
                                        <template x-for="(line, index) in debugMode.output" :key="index">
                                            <div class="mb-1" x-text="line"></div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 执行日志页面 -->
                <div x-show="currentPage === 'logs'" x-cloak>
                    <div class="mb-6 flex flex-col sm:flex-row gap-3 w-full">
                        <!-- 下拉选择框组 -->
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 flex-grow">
                            <select x-model="logFilter.taskId" @change="loadLogs()"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm sm:text-base">
                                <option value="">所有任务</option>
                                <template x-for="task in tasks" :key="task.id">
                                    <option :value="task.id" x-text="task.name"></option>
                                </template>
                            </select>
        
                            <select x-model="logFilter.status" @change="loadLogs()"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm sm:text-base">
                                <option value="">所有状态</option>
                                <option value="success">成功</option>
                                <option value="failed">失败</option>
                                <option value="running">运行中</option>
                            </select>
        
                            <select x-model="logPagination.pageSize" @change="loadLogs()"
                                    class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm sm:text-base">
                                <option value="20">每页20条</option>
                                <option value="50">每页50条</option>
                                <option value="100">每页100条</option>
                            </select>
                        </div>
                        <div class="flex justify-end">
                            <button @click="deleteFilteredLogs()"
                                    class="w-full sm:w-auto bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm sm:text-base">
                                删除筛选结果
                            </button>
                        </div>
                    </div>

                    <!-- 日志列表 -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">执行日志</h3>
                            <div x-show="logPagination.total > 0" class="text-sm text-gray-500">
                                共 <span x-text="logPagination.total"></span> 条记录，第 <span x-text="logPagination.currentPage"></span> / <span x-text="logPagination.totalPages"></span> 页
                            </div>
                        </div>
                        <div x-show="logsLoading" class="text-center py-8 text-gray-500">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            加载中...
                        </div>
                        <div x-show="!logsLoading" class="divide-y divide-gray-200">
                            <template x-for="log in logs" :key="log.id">
                                <div class="px-6 py-3">
                                    <div class="flex items-center justify-between mb-1">
                                        <div class="flex items-center">
                                            <div :class="'w-3 h-3 rounded-full mr-3 ' + (log.status === 'success' ? 'bg-green-400' : log.status === 'failed' ? 'bg-red-400' : 'bg-yellow-400')"></div>
                                            <h4 class="font-medium text-gray-900" x-text="log.task_name"></h4>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span :class="'px-2 py-1 text-xs font-medium rounded-full ' + (log.status === 'success' ? 'bg-green-100 text-green-800' : log.status === 'failed' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800')"
                                                  x-text="getStatusText(log.status)"></span>
                                            <button @click="deleteLog(log.id)"
                                                    class="text-red-600 hover:text-red-900 text-sm px-2 py-1 rounded hover:bg-red-50"
                                                    title="删除此日志">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-600 mb-1">
                                        开始时间: <span x-text="formatDateTime(log.start_time)"></span>
                                        <span x-show="log.end_time"> | 结束时间: <span x-text="formatDateTime(log.end_time)"></span></span>
                                    </div>
                                    <div x-show="log.output" class="mt-1">
                                        <button @click="log.showOutput = !log.showOutput"
                                                class="text-blue-600 hover:text-blue-900 text-sm">
                                            <span x-text="log.showOutput ? '隐藏输出' : '显示输出'"></span>
                                        </button>
                                        <pre x-show="log.showOutput" class="mt-1 bg-gray-100 p-3 rounded text-sm overflow-x-auto" x-text="log.output"></pre>
                                    </div>
                                    <div x-show="log.error_output" class="mt-1">
                                        <button @click="log.showError = !log.showError"
                                                class="text-red-600 hover:text-red-900 text-sm">
                                            <span x-text="log.showError ? '隐藏错误' : '显示错误'"></span>
                                        </button>
                                        <pre x-show="log.showError" class="mt-1 bg-red-50 p-3 rounded text-sm overflow-x-auto text-red-800" x-text="log.error_output"></pre>
                                    </div>
                                </div>
                            </template>
                            <div x-show="logs.length === 0" class="text-center py-8 text-gray-500">
                                暂无日志
                            </div>
                        </div>

                        <!-- 分页控件 -->
                        <div x-show="!logsLoading && logPagination.totalPages > 1" class="px-4 sm:px-6 py-4 border-t border-gray-200">
                            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                                <!-- 信息统计 - 在手机上单独一行显示 -->
                                <div class="text-sm text-gray-700 text-center sm:text-left w-full sm:w-auto">
                                    显示第 <span x-text="(logPagination.currentPage - 1) * logPagination.pageSize + 1" class="font-medium"></span> 到
                                    <span x-text="Math.min(logPagination.currentPage * logPagination.pageSize, logPagination.total)" class="font-medium"></span> 条，
                                    共 <span x-text="logPagination.total" class="font-medium"></span> 条记录
                                </div>
        
                                <!-- 分页按钮组 - 优化移动端显示 -->
                                <div class="flex flex-wrap justify-center gap-2 w-full sm:w-auto">
                                    <!-- 上一页按钮 -->
                                    <button @click="changePage(logPagination.currentPage - 1)"
                                            :disabled="logPagination.currentPage <= 1"
                                            :class="logPagination.currentPage <= 1 ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-50'"
                                            class="px-3 py-2 border border-gray-300 rounded-md text-sm flex-shrink-0">
                                        上一页
                                    </button>
            
                                    <!-- 页码按钮 - 移动端只显示必要页码 -->
                                    <template x-for="page in getPageNumbers()" :key="page">
                                        <button @click="changePage(page)"
                                                :class="{
                                                    'bg-blue-600 text-white': page === logPagination.currentPage,
                                                    'hidden sm:inline-block': logPagination.totalPages > 7 && page !== 1 && page !== logPagination.totalPages && Math.abs(page - logPagination.currentPage) > 1,
                                                    'bg-white text-gray-700 hover:bg-gray-50': page !== logPagination.currentPage
                                                }"
                                                class="px-3 py-2 border border-gray-300 rounded-md text-sm flex-shrink-0"
                                                x-text="page"></button>
                                    </template>
            
                                    <!-- 下一页按钮 -->
                                    <button @click="changePage(logPagination.currentPage + 1)"
                                            :disabled="logPagination.currentPage >= logPagination.totalPages"
                                            :class="logPagination.currentPage >= logPagination.totalPages ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'bg-white text-gray-700 hover:bg-gray-50'"
                                            class="px-3 py-2 border border-gray-300 rounded-md text-sm flex-shrink-0">
                                        下一页
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 环境变量页面 -->
                <div x-show="currentPage === 'env'" x-cloak>
                    <div class="mb-6">
                        <button @click="showEnvModal = true; editingEnv = null; resetEnvForm()"
                                class="btn-primary text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i>
                            创建变量
                        </button>
                    </div>

                    <!-- 环境变量列表 -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">环境变量</h3>
                        </div>
                        <div x-show="envVarsLoading" class="text-center py-8 text-gray-500">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            加载中...
                        </div>
                        <div x-show="!envVarsLoading && envVars.length === 0" class="text-center py-8 text-gray-500">
                            暂无环境变量
                        </div>
                        <div x-show="!envVarsLoading && envVars.length > 0" class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">变量名</th>
                                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">值</th>
                                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">描述</th>
                                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">更新时间</th>
                                        <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="env in envVars" :key="env.id">
                                        <tr>
                                            <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center space-x-2">
                                                    <span class="text-sm font-medium text-gray-900" x-text="env.key"></span>
                                                    <button @click="copyVariableName(env.key)"
                                                            class="link-primary hover:text-blue-900 text-xs"
                                                            title="复制变量名">
                                                        <i class="fas fa-copy"></i>
                                                    </button>
                                                </div>
                                            </td>
                                            <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900 max-w-xs sm:max-w-sm">
                                                    <span x-text="truncateValue(env.value)"></span>
                                                    <button @click="copyEnvValue(env.value)"
                                                            class="ml-1 sm:ml-2 link-primary hover:text-blue-900 text-xs">
                                                        <i class="fas fa-copy"></i>
                                                    </button>
                                                </div>
                                            </td>
                                            <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-500" x-text="env.description || '无描述'"></div>
                                            </td>
                                            <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-500" x-text="formatDateTime(env.updated_at || env.created_at)"></div>
                                            </td>
                                            <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm font-medium space-x-1 sm:space-x-2">
                                                <button @click="editEnv(env)" class="link-primary">编辑</button>
                                                <button @click="deleteEnv(env)" class="link-primary">删除</button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 包管理页面 -->
                <div x-show="currentPage === 'packages'" x-cloak>
                    <div class="mb-6 flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
                        <button @click="showPackageModal = true"
                                class="btn-primary text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i>
                            安装包
                        </button>
                        <div class="w-full sm:w-auto sm:max-w-xs">
                            <input type="text"
                                   x-model="packageSearchQuery"
                                   @input="filterPackages()"
                                   placeholder="搜索已安装的包..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                        </div>
                    </div>

                    <!-- 包管理标签页 -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex">
                                <button @click="packageTab = 'python'"
                                        :class="packageTab === 'python' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="w-1/2 py-2 px-1 text-center border-b-2 font-medium text-sm">
                                    Python包
                                    <span x-show="!packagesLoading && pythonPackages.length > 0"
                                          class="ml-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                                          x-text="packageSearchQuery ? filteredPythonPackages.length + '/' + pythonPackages.length : pythonPackages.length"></span>
                                </button>
                                <button @click="packageTab = 'nodejs'"
                                        :class="packageTab === 'nodejs' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="w-1/2 py-2 px-1 text-center border-b-2 font-medium text-sm">
                                    Node.js包
                                    <span x-show="!packagesLoading && nodejsPackages.length > 0"
                                          class="ml-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
                                          x-text="packageSearchQuery ? filteredNodejsPackages.length + '/' + nodejsPackages.length : nodejsPackages.length"></span>
                                </button>
                            </nav>
                        </div>
                        <div class="p-6">
                            <div x-show="packageTab === 'python'">
                                <div x-show="packagesLoading" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    加载中...
                                </div>
                                <div x-show="!packagesLoading" class="space-y-2">
                                    <template x-for="pkg in filteredPythonPackages" :key="pkg.name">
                                        <div class="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg">
                                            <div>
                                                <div class="font-medium text-gray-900" x-text="pkg.name"></div>
                                                <div class="text-sm text-gray-500" x-text="pkg.version"></div>
                                            </div>
                                            <button @click="uninstallPackage('python', pkg.name)"
                                                    class="text-red-600 hover:text-red-900 text-sm">卸载</button>
                                        </div>
                                    </template>
                                    <div x-show="filteredPythonPackages.length === 0 && pythonPackages.length > 0" class="text-center py-8 text-gray-500">
                                        未找到匹配的Python包
                                    </div>
                                    <div x-show="pythonPackages.length === 0" class="text-center py-8 text-gray-500">
                                        暂无已安装的Python包
                                    </div>
                                </div>
                            </div>
                            <div x-show="packageTab === 'nodejs'">
                                <div x-show="packagesLoading" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    加载中...
                                </div>
                                <div x-show="!packagesLoading" class="space-y-2">
                                    <template x-for="pkg in filteredNodejsPackages" :key="pkg.name">
                                        <div class="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg">
                                            <div>
                                                <div class="font-medium text-gray-900" x-text="pkg.name"></div>
                                                <div class="text-sm text-gray-500" x-text="pkg.version"></div>
                                            </div>
                                            <button @click="uninstallPackage('nodejs', pkg.name)"
                                                    class="text-red-600 hover:text-red-900 text-sm">卸载</button>
                                        </div>
                                    </template>
                                    <div x-show="filteredNodejsPackages.length === 0 && nodejsPackages.length > 0" class="text-center py-8 text-gray-500">
                                        未找到匹配的Node.js包
                                    </div>
                                    <div x-show="nodejsPackages.length === 0" class="text-center py-8 text-gray-500">
                                        暂无已安装的Node.js包
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 通知服务页面 -->
                <div x-show="currentPage === 'notifications'" x-cloak>
                    <div class="space-y-6">
                        <!-- 通知配置 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">通知方式</h3>
                                <!-- <p class="text-sm text-gray-500 mt-1">配置邮箱、PushPlus、WxPusher等通知方式</p> -->
                                <p class="text-sm text-gray-500 mt-1">需要测试通过后才能激活配置</p>
                            </div>
                            <div class="p-6">
                                <!-- 加载状态 -->
                                <div x-show="notificationConfigsLoading" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    加载中...
                                </div>

                                <!-- 通知配置列表 -->
                                <div x-show="!notificationConfigsLoading">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <template x-for="config in notificationConfigs" :key="config.id">
                                            <div class="border rounded-lg p-4">
                                                <div class="flex items-center justify-between">
                                                    <div>
                                                        <h4 class="font-medium text-gray-900" x-text="getNotificationDisplayNameWithAccount(config)"></h4>
                                                        <div class="flex items-center mt-1">
                                                            <div :class="config.is_active ? 'w-2 h-2 bg-green-500 rounded-full mr-2' : 'w-2 h-2 bg-gray-400 rounded-full mr-2'"></div>
                                                            <p class="text-sm text-gray-500" x-text="config.is_active ? '已激活' : '未激活'"></p>
                                                        </div>
                                                    </div>
                                                    <div class="flex space-x-2 whitespace-nowrap">
                                                        <button @click="testNotification(config.id)"
                                                                :disabled="isTestingNotification(config.id)"
                                                                :class="isTestingNotification(config.id) ? 'text-gray-400 cursor-not-allowed' : 'text-blue-600 hover:text-blue-900'"
                                                                class="text-sm flex-shrink-0">
                                                            <span x-show="!isTestingNotification(config.id)">测试</span>
                                                            <span x-show="isTestingNotification(config.id)">
                                                                <i class="fas fa-spinner fa-spin mr-1"></i>测试中
                                                            </span>
                                                        </button>
                                                        <button @click="editNotificationConfig(config)"
                                                                class="text-gray-600 hover:text-gray-900 text-sm flex-shrink-0">编辑</button>
                                                        <button @click="deleteNotificationConfig(config.id)"
                                                                class="text-red-600 hover:text-red-900 text-sm flex-shrink-0">删除</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>

                                    <!-- 空状态 -->
                                    <div x-show="!notificationConfigsLoading && notificationConfigs.length === 0" class="text-center py-8 text-gray-500">
                                        暂无通知配置
                                    </div>
                                </div>
                                <div class="mt-6">
                                    <button @click="showNotificationConfigModal = true"
                                            class="btn-primary text-white px-4 py-2 rounded-lg flex items-center">
                                        <i class="fas fa-plus mr-2"></i>
                                        添加通知配置
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 任务通知设置 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900">任务通知设置</h3>
                                    <!-- <p class="text-sm text-gray-500 mt-1">为每个任务配置通知方式和条件</p> -->
                                    <p class="text-sm text-gray-500 mt-1">激活后的通知方式才能被选择</p>
                                </div>
                                <button @click="loadNotificationTasks(1)"
                                        :disabled="tasksLoading"
                                        class="px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white rounded-lg text-sm flex items-center space-x-2">
                                    <i class="fas fa-sync-alt" :class="{'fa-spin': tasksLoading}"></i>
                                    <span>刷新列表</span>
                                </button>
                            </div>
                            <div class="p-6">
                                <div x-show="!tasksLoading">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <template x-for="task in notificationTasks" :key="task.id">
                                            <div class="border rounded-lg p-4 hover:border-gray-300 transition-colors"
                                                 x-init="updateTaskNotificationIndicator(task.id)">
                                                <div class="space-y-4">
                                                    <!-- 任务标题行 -->
                                                    <div class="flex items-center space-x-2">
                                                        <!-- 配置状态指示器 -->
                                                        <div x-show="hasNotificationConfig(task.id)" class="w-2 h-2 bg-green-500 rounded-full" title="已配置通知"></div>
                                                        <div x-show="!hasNotificationConfig(task.id)" class="w-2 h-2 bg-gray-300 rounded-full" title="未配置通知"></div>
                                                        <div class="flex-1">
                                                            <h4 class="font-medium text-gray-900" x-text="task.name"></h4>
                                                            <p class="text-sm text-gray-500" x-text="task.description || '无描述'"></p>
                                                        </div>
                                                    </div>

                                                    <!-- 通知配置表单 -->
                                                    <div class="space-y-4">
                                                        <div>
                                                            <label class="block text-sm font-medium text-gray-700 mb-1">通知方式</label>
                                                            <select x-model="(taskNotificationConfigs[task.id] = taskNotificationConfigs[task.id] || {notification_type: '', error_only: false, keywords: ''}).notification_type"
                                                                    @change="updateTaskNotificationIndicator(task.id)"
                                                                    class="block w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                                <option value="">不通知</option>
                                                                <template x-for="config in activeNotificationConfigs" :key="config.name">
                                                                    <option :value="config.name" x-text="getNotificationDisplayNameWithAccount(config)"></option>
                                                                </template>
                                                            </select>
                                                        </div>
                                                        <div>
                                                            <label class="block text-sm font-medium text-gray-700 mb-1">关键词推送</label>
                                                            <input type="text"
                                                                   x-model="(taskNotificationConfigs[task.id] = taskNotificationConfigs[task.id] || {notification_type: '', error_only: false, keywords: ''}).keywords"
                                                                   placeholder="多个关键词用英文逗号分隔"
                                                                   class="block w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                        </div>
                                                    </div>

                                                    <!-- 选项和保存按钮 -->
                                                    <div class="flex items-center justify-between">
                                                        <div class="flex items-center">
                                                            <input type="checkbox"
                                                                   x-model="(taskNotificationConfigs[task.id] = taskNotificationConfigs[task.id] || {notification_type: '', error_only: false, keywords: ''}).error_only"
                                                                   class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                                            <label class="ml-2 text-sm text-gray-700">仅推送报错</label>
                                                        </div>
                                                        <button @click="saveTaskNotificationConfig(task.id)"
                                                                class="btn-primary text-white px-4 py-2 rounded-md text-sm transition-colors">
                                                            保存配置
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                    <div x-show="notificationTasks.length === 0" class="text-center py-8 text-gray-500">
                                        暂无任务
                                    </div>

                                    <!-- 分页组件 -->
                                    <div x-show="notificationTasksPagination.totalPages > 1" class="mt-6 border-t border-gray-200 pt-6">
                                        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                                            <!-- 分页信息 -->
                                            <div class="text-sm text-gray-700">
                                                显示第 <span x-text="(notificationTasksPagination.page - 1) * notificationTasksPagination.pageSize + 1"></span>
                                                到 <span x-text="Math.min(notificationTasksPagination.page * notificationTasksPagination.pageSize, notificationTasksPagination.total)"></span>
                                                条，共 <span x-text="notificationTasksPagination.total"></span> 个任务
                                            </div>

                                            <!-- 分页按钮 -->
                                            <div class="flex items-center space-x-2">
                                                <!-- 上一页 -->
                                                <button @click="goToNotificationTaskPage(notificationTasksPagination.page - 1)"
                                                        :disabled="notificationTasksPagination.page <= 1"
                                                        :class="notificationTasksPagination.page <= 1 ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'"
                                                        class="px-3 py-2 text-white rounded-lg text-sm">
                                                    上一页
                                                </button>

                                                <!-- 页码按钮 -->
                                                <template x-for="page in Array.from({length: Math.min(5, notificationTasksPagination.totalPages)}, (_, i) => {
                                                    const start = Math.max(1, notificationTasksPagination.page - 2);
                                                    const end = Math.min(notificationTasksPagination.totalPages, start + 4);
                                                    const adjustedStart = Math.max(1, end - 4);
                                                    return adjustedStart + i;
                                                }).filter(p => p <= notificationTasksPagination.totalPages)" :key="page">
                                                    <button @click="goToNotificationTaskPage(page)"
                                                            :class="page === notificationTasksPagination.page ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'"
                                                            class="px-3 py-2 rounded-lg text-sm"
                                                            x-text="page">
                                                    </button>
                                                </template>

                                                <!-- 下一页 -->
                                                <button @click="goToNotificationTaskPage(notificationTasksPagination.page + 1)"
                                                        :disabled="notificationTasksPagination.page >= notificationTasksPagination.totalPages"
                                                        :class="notificationTasksPagination.page >= notificationTasksPagination.totalPages ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'"
                                                        class="px-3 py-2 text-white rounded-lg text-sm">
                                                    下一页
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div x-show="tasksLoading" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    加载中...
                                </div>
                            </div>
                        </div>

                        <!-- SendNotify配置 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">SendNotify配置</h3>
                                <p class="text-sm text-gray-500 mt-1">设置脚本使用 from SendNotify import send 时的默认通知方式</p>
                            </div>
                            <div class="p-6">
                                <!-- 加载状态 -->
                                <div x-show="sendNotifyConfigLoading" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    加载中...
                                </div>

                                <!-- SendNotify配置表单 -->
                                <div x-show="!sendNotifyConfigLoading" class="max-w-md">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">默认通知方式</label>
                                            <select x-model="sendNotifyConfig.notification_type"
                                                    class="block w-full border border-gray-300 rounded-md px-3 py-2">
                                                <option value="">不使用通知</option>
                                                <template x-for="config in activeNotificationConfigs" :key="config.name">
                                                    <option :value="config.name" x-text="getNotificationDisplayNameWithAccount(config)"></option>
                                                </template>
                                            </select>
                                            <p class="text-sm text-gray-500 mt-1">只能选择已激活的通知方式</p>
                                        </div>

                                        <div class="flex items-center justify-between">
                                            <div class="text-sm text-gray-600">
                                                <p>当前配置:
                                                    <span x-show="!sendNotifyConfig.notification_type" class="text-gray-400">未配置</span>
                                                    <span x-show="sendNotifyConfig.notification_type"
                                                          class="font-medium text-gray-900"
                                                          x-text="getNotificationDisplayName(sendNotifyConfig.notification_type)"></span>
                                                </p>
                                            </div>
                                            <button @click="saveSendNotifyConfig()"
                                                    :disabled="sendNotifyConfigSaving"
                                                    class="btn-primary text-white px-4 py-2 rounded-md text-sm transition-colors disabled:opacity-50">
                                                <span x-show="!sendNotifyConfigSaving">保存配置</span>
                                                <span x-show="sendNotifyConfigSaving">
                                                    <i class="fas fa-spinner fa-spin mr-1"></i>保存中
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 接口调试页面 -->
                <div x-show="currentPage === 'api-debug'" x-cloak>
                    <div class="space-y-6">
                        <!-- 页面标题 -->
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                                <button @click="showVariablesModal = true"
                                        class="px-3 py-2 text-sm font-medium text-gray-700 bg-gray-300 hover:bg-gray-200 rounded-md">
                                    <i class="fas fa-code mr-2"></i>
                                    <span class="hidden sm:inline">变量列表</span>
                                    <span class="sm:hidden">变量列表</span>
                                </button>
                                <button @click="showImportModal = true"
                                        class="px-3 py-2 text-sm font-medium text-white btn-primary rounded-md">
                                    <i class="fas fa-download mr-2"></i>
                                    <span class="hidden sm:inline">导入请求</span>
                                    <span class="sm:hidden">导入请求</span>
                                </button>
                                <button @click="showDebugConfigModal = true; editingDebugConfig = null; resetDebugConfigForm()"
                                        class="px-3 py-2 text-sm font-medium text-white btn-primary rounded-md">
                                    <i class="fas fa-plus mr-2"></i>
                                    <span class="hidden sm:inline">新建配置</span>
                                    <span class="sm:hidden">新建配置</span>
                                </button>
                            </div>
                        </div>

                        <!-- 快速调试区域 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">快速调试</h3>
                            </div>
                            <div class="p-4 sm:p-6 space-y-4">
                                <!-- 请求方法和URL -->
                                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                                    <select x-model="quickDebugForm.method" @change="updateQuickDebugHeaders()" class="border border-gray-300 rounded-md px-3 py-2 sm:w-auto">
                                        <option value="GET">GET</option>
                                        <option value="POST">POST</option>
                                        <!-- <option value="PUT">PUT</option>
                                        <option value="DELETE">DELETE</option>
                                        <option value="PATCH">PATCH</option>
                                        <option value="HEAD">HEAD</option>
                                        <option value="OPTIONS">OPTIONS</option> -->
                                    </select>
                                    <input type="url" x-model="quickDebugForm.url" @input="updateQuickDebugHeaders()" placeholder="请输入请求URL"
                                           class="flex-1 border border-gray-300 rounded-md px-3 py-2">
                                    <button @click="executeQuickDebug()"
                                            :disabled="!quickDebugForm.url || quickDebugExecuting"
                                            class="px-4 sm:px-6 py-2 text-sm font-medium text-white btn-primary rounded-md disabled:opacity-50 whitespace-nowrap">
                                        <i :class="quickDebugExecuting ? 'fas fa-spinner fa-spin' : 'fas fa-play'" class="mr-2"></i>
                                        <span x-text="quickDebugExecuting ? '请求中...' : '发送'"></span>
                                    </button>
                                </div>

                                <!-- 请求头 -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">请求头</label>
                                    <div class="space-y-2">
                                        <template x-for="(header, index) in quickDebugForm.headers" :key="index">
                                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                                <!-- Header名称 -->
                                                <input type="text" x-model="header.key" placeholder="Header名称"
                                                       :readonly="header.readonly"
                                                       :class="header.readonly ? 'bg-gray-100 text-gray-600' : ''"
                                                       class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                <!-- Header值和图标在同一行 -->
                                                <div class="flex space-x-2 flex-1">
                                                    <input type="text" x-model="header.value" placeholder="Header值"
                                                           :readonly="header.readonly"
                                                           :class="header.readonly ? 'bg-gray-100 text-gray-600' : ''"
                                                           class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                    <button @click="quickDebugForm.headers.splice(index, 1)"
                                                            x-show="!header.readonly"
                                                            class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-md flex-shrink-0">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                    <div x-show="header.readonly" class="px-3 py-2 text-gray-400 flex-shrink-0">
                                                        <i class="fas fa-lock"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                        <button @click="quickDebugForm.headers.push({key: '', value: '', readonly: false})"
                                                class="text-sm theme-primary-text hover:opacity-80 text-sm">
                                            <i class="fas fa-plus mr-1"></i>
                                            添加请求头
                                        </button>
                                    </div>
                                </div>

                                <!-- 请求体 -->
                                <div x-show="['POST', 'PUT', 'PATCH'].includes(quickDebugForm.method)">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">请求体（Payload）</label>
                                    <textarea x-model="quickDebugForm.payload" @input="updateQuickDebugHeaders()" rows="6" placeholder="请输入请求体内容"
                                              class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm font-mono"></textarea>
                                </div>

                                <!-- 通知设置 -->
                                <div class="border-t pt-4">
                                    <div class="flex flex-col space-y-3">
                                        <div class="flex items-center justify-between">
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="quickDebugForm.notification_enabled"
                                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                                <span class="ml-2 text-sm text-gray-700">启用通知</span>
                                            </label>
                                            <button @click="saveQuickDebugAsConfig()"
                                                    class="px-3 py-1.5 text-sm font-medium text-white btn-primary rounded-md">
                                                <i class="fas fa-save mr-1"></i>
                                                <span class="hidden sm:inline">保存配置</span>
                                                <span class="sm:hidden">保存</span>
                                            </button>
                                        </div>
                                        <div x-show="quickDebugForm.notification_enabled" class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                                            <select x-model="quickDebugForm.notification_type"
                                                    class="border border-gray-300 rounded-md px-3 py-2 text-sm flex-1">
                                                <option value="">选择通知方式</option>
                                                <template x-for="config in notificationConfigs" :key="config.name">
                                                    <option :value="config.name" x-text="getNotificationDisplayNameWithAccount(config)"></option>
                                                </template>
                                            </select>
                                            <select x-model="quickDebugForm.notification_condition"
                                                    class="border border-gray-300 rounded-md px-3 py-2 text-sm flex-1">
                                                <option value="always">总是通知</option>
                                                <option value="success">成功时通知</option>
                                                <option value="error">失败时通知</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 响应结果 -->
                        <div x-show="quickDebugResult" class="bg-white rounded-lg shadow">
                            <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">响应结果</h3>
                            </div>
                            <div class="p-4 sm:p-6">
                                <div x-show="quickDebugResult" class="space-y-4">
                                    <!-- 响应状态 -->
                                    <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                                        <div class="flex items-center">
                                            <span class="text-sm font-medium text-gray-700">状态:</span>
                                            <span :class="quickDebugResult && quickDebugResult.status === 'success' ? 'text-green-600' : 'text-red-600'"
                                                  class="ml-2 font-medium" x-text="quickDebugResult ? quickDebugResult.status : ''"></span>
                                        </div>
                                        <div x-show="quickDebugResult && quickDebugResult.response" class="flex items-center">
                                            <span class="text-sm font-medium text-gray-700">状态码:</span>
                                            <span :class="quickDebugResult && quickDebugResult.response && quickDebugResult.response.status_code < 400 ? 'text-green-600' : 'text-red-600'"
                                                  class="ml-2 font-medium" x-text="quickDebugResult && quickDebugResult.response ? quickDebugResult.response.status_code : ''"></span>
                                        </div>
                                        <div x-show="quickDebugResult && quickDebugResult.response" class="flex items-center">
                                            <span class="text-sm font-medium text-gray-700">响应时间:</span>
                                            <span class="ml-2 text-gray-900" x-text="quickDebugResult && quickDebugResult.response ? quickDebugResult.response.response_time + 'ms' : ''"></span>
                                        </div>
                                    </div>

                                    <!-- 错误信息 -->
                                    <div x-show="quickDebugResult && quickDebugResult.error" class="bg-red-50 border border-red-200 rounded-md p-4">
                                        <h4 class="text-sm font-medium text-red-800 mb-2">错误信息</h4>
                                        <pre class="text-sm text-red-700 whitespace-pre-wrap" x-text="quickDebugResult && quickDebugResult.error ? quickDebugResult.error : ''"></pre>
                                    </div>

                                    <!-- 响应内容标签页 -->
                                    <div x-show="quickDebugResult && quickDebugResult.response">
                                        <div class="border-b border-gray-200">
                                            <nav class="-mb-px flex">
                                                <button @click="responseTab = 'body'"
                                                        :class="responseTab === 'body' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                                        class="py-2 px-4 border-b-2 font-medium text-sm">
                                                    响应体
                                                </button>
                                                <button @click="responseTab = 'headers'"
                                                        :class="responseTab === 'headers' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                                        class="py-2 px-4 border-b-2 font-medium text-sm">
                                                    响应头
                                                </button>
                                            </nav>
                                        </div>
                                        <div class="mt-4">
                                            <div x-show="responseTab === 'body'">
                                                <pre class="bg-gray-900 text-green-400 p-4 rounded text-sm overflow-auto font-mono whitespace-pre-wrap max-h-96"
                                                     x-text="quickDebugResult && quickDebugResult.response ? quickDebugResult.response.body : ''"></pre>
                                            </div>
                                            <div x-show="responseTab === 'headers'">
                                                <div class="space-y-2">
                                                    <template x-for="(value, key) in (quickDebugResult && quickDebugResult.response ? quickDebugResult.response.headers : {})" :key="key">
                                                        <div class="flex">
                                                            <span class="font-medium text-gray-700 w-1/3" x-text="key + ':'"></span>
                                                            <span class="text-gray-900 w-2/3" x-text="value"></span>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 保存的配置列表 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">保存的配置</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200" style="white-space: nowrap;">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">名称</th>
                                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方法</th>
                                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">URL</th>
                                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">通知</th>
                                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cron</th>
                                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <template x-for="config in debugConfigs" :key="config.id">
                                            <tr>
                                                <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900" x-text="config.name"></div>
                                                    <div class="text-sm text-gray-500" x-text="config.description"></div>
                                                </td>
                                                <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                                          :class="getMethodColor(config.method)" x-text="config.method"></span>
                                                </td>
                                                <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900 max-w-xs truncate" x-text="config.url"></div>
                                                </td>
                                                <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                    <div x-show="config.notification_enabled" class="flex items-center">
                                                        <div class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                                                        <span class="text-sm text-gray-900" x-text="config.notification_type"></span>
                                                    </div>
                                                    <span x-show="!config.notification_enabled" class="text-sm text-gray-400">未启用</span>
                                                </td>
                                                <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                                                    <div x-show="config.is_active" class="flex items-center">
                                                        <div class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                                                        <span class="text-sm text-gray-900" x-text="config.cron_expression"></span>
                                                    </div>
                                                    <span x-show="!config.is_active" class="text-sm text-gray-400">未启用</span>
                                                </td>
                                                <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <div class="flex space-x-2">
                                                        <button @click="executeDebugConfig(config)"
                                                                class="text-blue-600 hover:text-blue-900" title="执行">
                                                            <i class="fas fa-play"></i>
                                                        </button>
                                                        <button @click="editDebugConfig(config)"
                                                                class="text-indigo-600 hover:text-indigo-900" title="编辑">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button @click="deleteDebugConfig(config.id)"
                                                                class="text-red-600 hover:text-red-900" title="删除">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </template>
                                        <tr x-show="debugConfigs.length === 0">
                                            <td colspan="6" class="px-3 sm:px-6 py-4 text-center text-gray-500">
                                                暂无保存的配置
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 脚本订阅页面 -->
                <div x-show="currentPage === 'subscriptions'" x-cloak>
                    <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <div class="flex flex-col sm:flex-row gap-2">
                            <button @click="loadProxyConfig(); showProxyConfigModal = true"
                                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                                <i class="fas fa-globe mr-2"></i>代理设置
                            </button>
                            <button @click="openSubscriptionModal()"
                                    class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                                <i class="fas fa-plus mr-2"></i>新建订阅
                            </button>
                        </div>
                    </div>

                    <!-- 订阅列表 -->
                    <div class="bg-white rounded-lg shadow">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-medium text-gray-900">订阅列表</h3>
                        </div>
                        <div x-show="subscriptionsLoading" class="text-center py-8 text-gray-500">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            加载中...
                        </div>
                        <div x-show="!subscriptionsLoading && subscriptions.length === 0" class="text-center py-8 text-gray-500">
                            暂无订阅
                        </div>
                        <div x-show="!subscriptionsLoading && subscriptions.length > 0" class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">订阅信息</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Git仓库</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">配置</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最后同步</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="subscription in subscriptions" :key="subscription.id">
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div>
                                                    <div class="flex items-center space-x-2">
                                                        <span class="text-sm font-medium text-gray-900" x-text="subscription.name"></span>
                                                        <button @click="checkRequirements(subscription)"
                                                                x-show="subscription.has_requirements !== false"
                                                                class="text-blue-600 hover:text-blue-800 text-xs"
                                                                title="检查requirements.txt依赖">
                                                            <i class="fas fa-list-check"></i>
                                                        </button>
                                                    </div>
                                                    <div class="text-sm text-gray-500" x-text="subscription.description || '无描述'"></div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="text-sm text-gray-900 break-all" x-text="subscription.git_url"></div>
                                                <div class="text-sm text-gray-500">
                                                    保存到: <span x-text="subscription.save_directory"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900">
                                                    <div>文件类型: <span x-text="formatFileExtensions(subscription.file_extensions)"></span></div>
                                                    <div>Cron: <span x-text="subscription.cron_expression"></span></div>
                                                    <div x-show="subscription.use_proxy" class="text-blue-600">
                                                        <i class="fas fa-globe mr-1"></i>使用代理
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <span x-text="formatLastSyncTime(subscription.last_sync_time)"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                                <button @click="syncSubscription(subscription)"
                                                        :disabled="isSyncingSubscription(subscription.id)"
                                                        :class="isSyncingSubscription(subscription.id) ? 'text-gray-400 cursor-not-allowed' : 'link-primary'">
                                                    <i :class="isSyncingSubscription(subscription.id) ? 'fas fa-spinner fa-spin mr-1' : 'fas fa-sync-alt mr-1'"></i>
                                                    <span x-text="isSyncingSubscription(subscription.id) ? '同步中' : '同步'"></span>
                                                </button>
                                                <button @click="loadSubscriptionLogs(subscription)"
                                                        class="link-primary">日志
                                                </button>
                                                <button @click="openSubscriptionModal(subscription)"
                                                        class="link-primary">编辑
                                                </button>
                                                <button @click="deleteSubscription(subscription)"
                                                        class="link-primary">删除
                                                </button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 系统设置页面 -->
                <div x-show="currentPage === 'settings'" x-cloak>
                    <div class="space-y-6">
                        <!-- 用户信息和版本升级 - 左右两栏布局 -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- 用户信息 -->
                            <div class="bg-white rounded-lg shadow">
                                <div class="px-6 py-4 border-b border-gray-200">
                                    <h3 class="text-lg font-medium text-gray-900">用户信息</h3>
                                </div>
                                <div class="p-6 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">用户名</label>
                                            <p class="mt-1 text-sm text-gray-900" x-text="user ? user.username : '加载中...'"></p>
                                        </div>
                                        <button @click="showChangeUsernameModal = true"
                                                class="theme-primary-text hover:opacity-80 text-sm">修改</button>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">密码</label>
                                            <p class="mt-1 text-sm text-gray-900">••••••••</p>
                                        </div>
                                        <button @click="showChangePasswordModal = true"
                                                class="theme-primary-text hover:opacity-80 text-sm">修改</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 版本升级 -->
                            <div class="bg-white rounded-lg shadow">
                                <div class="px-6 py-4 border-b border-gray-200">
                                    <h3 class="text-lg font-medium text-gray-900">版本升级</h3>
                                </div>
                                <div class="p-6 space-y-4">
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">当前版本</label>
                                            <div class="mt-1 flex items-center space-x-2">
                                                <p class="text-sm text-gray-900" x-text="versionInfo.current_version || '加载中...'"></p>
                                                <button @click="showVersionHistoryModal()"
                                                        class="link-primary hover:text-blue-900 text-xs"
                                                        title="查看历史版本">
                                                    <i class="fas fa-history"></i>
                                                    历史
                                                </button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">最新版本</label>
                                            <div class="mt-1 flex items-center space-x-2">
                                                <p class="text-sm text-gray-900" x-text="versionInfo.latest_version || '检查中...'"></p>
                                                <div x-show="versionInfo.has_update" class="flex items-center">
                                                    <button @click="showVersionUpgradeModal()"
                                                            class="text-orange-600 hover:text-orange-800 cursor-pointer">
                                                        <i class="fas fa-arrow-up text-sm"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div x-show="versionInfo.has_update" class="p-3 bg-orange-50 border border-orange-200 rounded-md">
                                        <div class="flex items-center">
                                            <i class="fas fa-info-circle text-orange-600 mr-2"></i>
                                            <span class="text-sm text-orange-800">发现新版本，点击最新版本号箭头查看详情</span>
                                        </div>
                                    </div>
                                    <div x-show="versionInfo.current_version && versionInfo.latest_version && !versionInfo.has_update && isCurrentVersionNewer()" class="p-3 bg-purple-50 border border-purple-200 rounded-md">
                                        <div class="flex items-center">
                                            <i class="fas fa-question-circle text-purple-600 mr-2"></i>
                                            <span class="text-sm text-purple-800">不对劲，十分有九分不对劲</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 安全配置 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">安全配置</h3>
                                <p class="mt-1 text-sm text-gray-600">配置登录安全策略和多因素认证</p>
                            </div>
                            <div class="p-6 space-y-6">
                                <div x-show="securityConfigLoading" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    加载中...
                                </div>

                                <div x-show="!securityConfigLoading" class="space-y-6">
                                    <!-- 登录失败限制 -->
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <h4 class="font-medium text-gray-900 mb-4">登录失败限制</h4>
                                        <div class="space-y-4">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <label class="text-sm font-medium text-gray-700">启用验证码</label>
                                                    <p class="text-xs text-gray-500">登录失败5次后显示验证码</p>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" x-model="securityConfig.captcha_enabled" class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                </label>
                                            </div>

                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <label class="text-sm font-medium text-gray-700">启用IP阻止</label>
                                                    <p class="text-xs text-gray-500">登录失败5次后阻止IP访问</p>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" x-model="securityConfig.ip_blocking_enabled" class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 多因素认证 -->
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <h4 class="font-medium text-gray-900 mb-4">多因素认证</h4>
                                        <div class="space-y-4">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <label class="text-sm font-medium text-gray-700">启用多因素认证</label>
                                                    <p class="text-xs text-gray-500">登录时需要额外的验证码</p>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" x-model="securityConfig.mfa_enabled" class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                                </label>
                                            </div>

                                            <div x-show="securityConfig.mfa_enabled" class="space-y-3">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">通知方式</label>
                                                    <select x-model="securityConfig.mfa_notification_type"
                                                            class="w-full border border-gray-300 rounded-md px-3 py-2">
                                                        <option value="">请选择通知方式</option>
                                                        <template x-for="config in activeNotificationConfigs" :key="config.name">
                                                            <option :value="config.name" x-text="getNotificationDisplayNameWithAccount(config)"></option>
                                                        </template>
                                                    </select>
                                                    <p class="text-xs text-gray-500 mt-1">需要先在"通知服务"页面配置并激活通知方式</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 保存按钮 -->
                                    <div class="flex justify-end">
                                        <button @click="saveSecurityConfig()" :disabled="securityConfigSaving"
                                                class="px-6 py-2 btn-primary text-white rounded-lg disabled:opacity-50">
                                            <span x-show="!securityConfigSaving">保存配置</span>
                                            <span x-show="securityConfigSaving" class="flex items-center">
                                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                                保存中...
                                            </span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 配色方案设置 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">配色方案</h3>
                                <p class="mt-1 text-sm text-gray-600">选择您喜欢的界面配色方案</p>
                            </div>
                            <div class="p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <template x-for="scheme in colorSchemes" :key="scheme.id">
                                        <div @click="updateColorScheme(scheme.id)"
                                             :class="currentColorScheme === scheme.id ? 'selected' : ''"
                                             class="color-scheme-card bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-all duration-200 cursor-pointer">
                                            <div class="flex items-center justify-between mb-3">
                                                <div class="flex items-center">
                                                    <i x-show="scheme.icon" :class="scheme.icon" class="mr-2 text-gray-600"></i>
                                                    <h4 class="font-medium text-gray-900" x-text="scheme.name"></h4>
                                                </div>
                                                <div x-show="currentColorScheme === scheme.id" class="theme-primary-text">
                                                    <i class="fas fa-check-circle text-lg"></i>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2 mb-3">
                                                <template x-for="(color, index) in scheme.colors" :key="index">
                                                    <div class="w-6 h-6 rounded-full border border-gray-200 shadow-sm"
                                                         :style="'background-color: ' + color"></div>
                                                </template>
                                            </div>
                                            <p class="text-sm text-gray-600" x-text="scheme.description"></p>
                                            <div x-show="currentColorScheme === scheme.id" class="mt-3 pt-3 border-t border-gray-200">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                    <i class="fas fa-check mr-1"></i>
                                                    当前使用
                                                </span>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- 日志管理 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">日志管理</h3>
                                <p class="mt-1 text-sm text-gray-600">管理系统日志和自动清理设置</p>
                            </div>
                            <div class="p-6 space-y-6">
                                <!-- 清空所有日志 -->
                                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                    <div>
                                        <h4 class="font-medium text-gray-900">清空所有日志</h4>
                                        <p class="text-sm text-gray-500">删除系统中的所有执行日志记录</p>
                                    </div>
                                    <button @click="clearAllLogs()"
                                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                                        清空
                                    </button>
                                </div>

                                <!-- 自动清理设置 -->
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-medium text-gray-900 mb-4">自动清理设置</h4>
                                    <div class="space-y-4">
                                        <div class="flex items-center">
                                            <input type="checkbox" x-model="logCleanupSettings.enabled"
                                                   class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                            <label class="ml-2 text-sm text-gray-700">启用自动清理</label>
                                        </div>
                                        <div x-show="logCleanupSettings.enabled" class="space-y-3">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">清理周期</label>
                                                <select x-model="logCleanupSettings.retentionDays"
                                                        class="border border-gray-300 rounded-md px-3 py-2">
                                                    <option value="7">保留7天</option>
                                                    <option value="15">保留15天</option>
                                                    <option value="30">保留30天</option>
                                                </select>
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                系统将自动删除 <span x-text="logCleanupSettings.retentionDays"></span> 天前的日志记录
                                            </div>
                                            <button @click="saveLogCleanupSettings()"
                                                    class="btn-primary text-white px-4 py-2 rounded-lg text-sm">
                                                保存设置
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 命令配置 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">命令配置</h3>
                                <p class="mt-1 text-sm text-gray-600">配置脚本执行时使用的命令</p>
                            </div>
                            <div class="p-6 space-y-6">
                                <!-- 脚本执行命令配置 -->
                                <div>
                                    <h4 class="text-md font-medium text-gray-900 mb-4">脚本执行命令</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <!-- Python执行命令 -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Python执行命令</label>
                                            <div class="flex space-x-2">
                                                <input type="text" x-model="commandConfig.python_command"
                                                       placeholder="python"
                                                       class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                <button @click="testCommand('python')"
                                                        :disabled="isTestingCommand"
                                                        class="px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-md text-sm whitespace-nowrap">
                                                    <span x-show="!isTestingCommand">测试</span>
                                                    <span x-show="isTestingCommand">
                                                        <i class="fas fa-spinner fa-spin"></i>
                                                    </span>
                                                </button>
                                            </div>
                                            <p class="mt-1 text-xs text-gray-500">
                                                例如: python、python3、完整路径
                                            </p>
                                            <div x-show="commandTestResult.python" class="mt-2">
                                                <div x-show="commandTestResult.python && commandTestResult.python.success" class="text-sm text-green-600">
                                                    <i class="fas fa-check-circle mr-1"></i>
                                                    <span x-text="commandTestResult.python ? commandTestResult.python.message : ''"></span>
                                                </div>
                                                <div x-show="commandTestResult.python && !commandTestResult.python.success" class="text-sm text-red-600">
                                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                                    <span x-text="commandTestResult.python ? commandTestResult.python.message : ''"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Node.js执行命令 -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Node.js执行命令</label>
                                            <div class="flex space-x-2">
                                                <input type="text" x-model="commandConfig.nodejs_command"
                                                       placeholder="node"
                                                       class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                <button @click="testCommand('nodejs')"
                                                        :disabled="isTestingCommand"
                                                        class="px-3 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-md text-sm whitespace-nowrap">
                                                    <span x-show="!isTestingCommand">测试</span>
                                                    <span x-show="isTestingCommand">
                                                        <i class="fas fa-spinner fa-spin"></i>
                                                    </span>
                                                </button>
                                            </div>
                                            <p class="mt-1 text-xs text-gray-500">
                                                例如: node、nodejs、完整路径
                                            </p>
                                            <div x-show="commandTestResult.nodejs" class="mt-2">
                                                <div x-show="commandTestResult.nodejs && commandTestResult.nodejs.success" class="text-sm text-green-600">
                                                    <i class="fas fa-check-circle mr-1"></i>
                                                    <span x-text="commandTestResult.nodejs ? commandTestResult.nodejs.message : ''"></span>
                                                </div>
                                                <div x-show="commandTestResult.nodejs && !commandTestResult.nodejs.success" class="text-sm text-red-600">
                                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                                    <span x-text="commandTestResult.nodejs ? commandTestResult.nodejs.message : ''"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 包管理器配置 -->
                                <div class="border-t border-gray-200 pt-6">
                                    <h4 class="text-md font-medium text-gray-900 mb-4">包管理器</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <!-- Python包管理器 -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Python包管理器</label>
                                            <div class="flex space-x-2">
                                                <input type="text" x-model="commandConfig.python_package_manager"
                                                       placeholder="pip"
                                                       class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                <button @click="testPackageManager('python')"
                                                        :disabled="isTestingPackageManager"
                                                        class="px-3 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-md text-sm whitespace-nowrap">
                                                    <span x-show="!isTestingPackageManager">测试</span>
                                                    <span x-show="isTestingPackageManager">
                                                        <i class="fas fa-spinner fa-spin"></i>
                                                    </span>
                                                </button>
                                            </div>
                                            <p class="mt-1 text-xs text-gray-500">
                                                例如: pip、conda、poetry、完整路径
                                            </p>
                                            <div x-show="packageManagerTestResult.python" class="mt-2">
                                                <div x-show="packageManagerTestResult.python && packageManagerTestResult.python.success" class="text-sm text-green-600">
                                                    <i class="fas fa-check-circle mr-1"></i>
                                                    <span x-text="packageManagerTestResult.python ? packageManagerTestResult.python.message : ''"></span>
                                                </div>
                                                <div x-show="packageManagerTestResult.python && !packageManagerTestResult.python.success" class="text-sm text-red-600">
                                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                                    <span x-text="packageManagerTestResult.python ? packageManagerTestResult.python.message : ''"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Node.js包管理器 -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Node.js包管理器</label>
                                            <div class="flex space-x-2">
                                                <input type="text" x-model="commandConfig.nodejs_package_manager"
                                                       placeholder="npm"
                                                       class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                <button @click="testPackageManager('nodejs')"
                                                        :disabled="isTestingPackageManager"
                                                        class="px-3 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-md text-sm whitespace-nowrap">
                                                    <span x-show="!isTestingPackageManager">测试</span>
                                                    <span x-show="isTestingPackageManager">
                                                        <i class="fas fa-spinner fa-spin"></i>
                                                    </span>
                                                </button>
                                            </div>
                                            <p class="mt-1 text-xs text-gray-500">
                                                例如: npm、yarn、pnpm、完整路径
                                            </p>
                                            <div x-show="packageManagerTestResult.nodejs" class="mt-2">
                                                <div x-show="packageManagerTestResult.nodejs && packageManagerTestResult.nodejs.success" class="text-sm text-green-600">
                                                    <i class="fas fa-check-circle mr-1"></i>
                                                    <span x-text="packageManagerTestResult.nodejs ? packageManagerTestResult.nodejs.message : ''"></span>
                                                </div>
                                                <div x-show="packageManagerTestResult.nodejs && !packageManagerTestResult.nodejs.success" class="text-sm text-red-600">
                                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                                    <span x-text="packageManagerTestResult.nodejs ? packageManagerTestResult.nodejs.message : ''"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 保存按钮 -->
                                <div class="pt-4 border-t border-gray-200">
                                    <button @click="saveCommandConfig()"
                                            :disabled="isSavingCommandConfig"
                                            class="px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white rounded-md text-sm">
                                        <span x-show="!isSavingCommandConfig">保存配置</span>
                                        <span x-show="isSavingCommandConfig">
                                            <i class="fas fa-spinner fa-spin mr-1"></i>保存中
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 系统信息 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">系统信息</h3>
                            </div>
                            <div class="p-6">
                                <div x-show="systemInfoLoading" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                    加载中...
                                </div>
                                <div x-show="!systemInfoLoading && systemInfo" class="space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Python版本</label>
                                            <p class="mt-1 text-sm text-gray-900" x-text="systemInfo ? systemInfo.python_version : '加载中...'"></p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Node.js版本</label>
                                            <p class="mt-1 text-sm text-gray-900" x-text="systemInfo ? systemInfo.nodejs_version : '加载中...'"></p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">操作系统</label>
                                                <p class="mt-1 text-sm text-gray-900"
                                                       x-text="systemInfo && systemInfo.system_info ?
                                                              `${systemInfo.system_info.platform} (${systemInfo.system_info.platform_version})` :
                                                              '加载中...'">
                                                </p>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">系统架构</label>
                                            <p class="mt-1 text-sm text-gray-900" x-text="systemInfo && systemInfo.system_info ? systemInfo.system_info.architecture : '加载中...'"></p>
                                        </div>
                                    </div>

                                    <!-- 时区设置 -->
                                    <div class="border-t border-gray-200 pt-4">
                                        <div class="flex items-center justify-between mb-4">
                                            <h4 class="text-md font-medium text-gray-900">时区设置</h4>
                                            <button @click="refreshTimezoneConfig()"
                                                    class="text-sm text-blue-600 hover:text-blue-800">
                                                <i class="fas fa-sync-alt mr-1"></i>
                                                刷新
                                            </button>
                                        </div>
                                        <div x-show="timezoneConfigLoading" class="text-center py-4 text-gray-500">
                                            <i class="fas fa-spinner fa-spin mr-2"></i>
                                            加载时区配置...
                                        </div>
                                        <div x-show="!timezoneConfigLoading && timezoneConfig" class="space-y-4">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700">当前时区</label>
                                                    <p class="mt-1 text-sm text-gray-900" x-text="timezoneConfig ? timezoneConfig.current_timezone_display : '加载中...'"></p>
                                                    <p class="text-xs text-gray-500" x-text="timezoneConfig ? `偏移量: ${timezoneConfig.current_offset}` : ''"></p>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700">当前时间</label>
                                                    <p class="mt-1 text-sm text-gray-900" x-text="currentTime ? formatDynamicTime(currentTime.local) : '加载中...'"></p>
                                                    <p class="text-xs text-gray-500" x-text="currentTime ? `UTC: ${formatDynamicTime(currentTime.utc)}` : ''"></p>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">选择时区</label>
                                                <div class="flex flex-col sm:flex-row sm:space-x-2 space-y-2 sm:space-y-0">
                                                    <select x-model="selectedTimezone"
                                                            class="flex-1 border border-gray-300 rounded-md px-3 py-2 text-sm">
                                                        <option value="">请选择时区...</option>
                                                        <template x-for="tz in (timezoneConfig ? timezoneConfig.available_timezones : [])" :key="tz.name">
                                                            <option :value="tz.name" x-text="`${tz.display_name} (${tz.offset})`"></option>
                                                        </template>
                                                    </select>
                                                    <button @click="updateTimezone()"
                                                            :disabled="!selectedTimezone || timezoneUpdating"
                                                            class="px-4 py-2 btn-primary text-white rounded-md text-sm disabled:opacity-50 disabled:cursor-not-allowed sm:flex-shrink-0">
                                                        <span x-show="!timezoneUpdating">保存</span>
                                                        <span x-show="timezoneUpdating">
                                                            <i class="fas fa-spinner fa-spin mr-1"></i>
                                                            保存中...
                                                        </span>
                                                    </button>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-1">时区更改后立即生效，影响所有时间显示</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 备份与恢复 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">备份与恢复</h3>
                                <p class="mt-1 text-sm text-gray-600">导出系统备份或从备份文件恢复系统数据</p>
                            </div>
                            <div class="p-6 space-y-6">
                                <!-- 导出备份 -->
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-4">
                                        <div>
                                            <h4 class="font-medium text-gray-900">导出备份</h4>
                                            <p class="text-sm text-gray-500 mt-1">将导出数据库和所有脚本文件</p>
                                        </div>
                                        <button @click="exportBackup()"
                                                :disabled="backupExporting"
                                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                            <span x-show="!backupExporting">
                                                <i class="fas fa-download mr-2"></i>
                                                导出
                                            </span>
                                            <span x-show="backupExporting">
                                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                                创建中...
                                            </span>
                                        </button>
                                    </div>

                                    <!-- 备份进度和结果 -->
                                    <div x-show="backupResult" class="mt-4 p-3 bg-green-50 border border-green-200 rounded-md">
                                        <div class="flex items-center">
                                            <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                            <span class="text-sm text-green-800" x-text="backupResult?.message"></span>
                                        </div>
                                        <div class="mt-2 text-xs text-green-700">
                                            文件大小: <span x-text="formatFileSize(backupResult?.size)"></span>
                                        </div>
                                        <div class="mt-2">
                                            <a :href="`/api/settings/download-backup/${backupResult?.filename}`"
                                               class="inline-flex items-center px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-xs">
                                                <i class="fas fa-download mr-1"></i>
                                                下载备份文件
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <!-- 导入备份 -->
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="mb-4">
                                        <h4 class="font-medium text-gray-900">导入备份</h4>
                                        <p class="text-sm text-gray-500 mt-1">从备份文件恢复系统数据（将覆盖现有数据）</p>
                                    </div>

                                    <div class="space-y-4">
                                        <!-- 文件选择 -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">选择备份文件</label>
                                            <input type="file"
                                                   accept=".pb"
                                                   @change="handleBackupFileSelect($event)"
                                                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                            <p class="text-xs text-gray-500 mt-1">仅支持.pb格式的备份文件</p>
                                        </div>

                                        <!-- 导入按钮 -->
                                        <div class="flex items-center space-x-3">
                                            <button @click="importBackup()"
                                                    :disabled="!selectedBackupFile || backupImporting"
                                                    class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                                <span x-show="!backupImporting">
                                                    <i class="fas fa-upload mr-2"></i>
                                                    导入备份
                                                </span>
                                                <span x-show="backupImporting">
                                                    <i class="fas fa-spinner fa-spin mr-2"></i>
                                                    导入中...
                                                </span>
                                            </button>
                                            <span x-show="selectedBackupFile" class="text-sm text-gray-600">
                                                已选择: <span x-text="selectedBackupFile?.name"></span>
                                            </span>
                                        </div>

                                        <!-- 警告提示 -->
                                        <div class="bg-yellow-50 border border-yellow-200 rounded-md p-3">
                                            <div class="flex">
                                                <i class="fas fa-exclamation-triangle text-yellow-600 mr-2 mt-0.5"></i>
                                                <div class="text-sm text-yellow-800">
                                                    <p class="font-medium">注意事项：</p>
                                                    <ul class="mt-1 list-disc list-inside space-y-1">
                                                        <li>导入操作将覆盖现有的脚本文件和数据库数据</li>
                                                        <li>导入完成后将自动退出登录，需要重新登录</li>
                                                        <li>建议在导入前先创建当前系统的备份</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 导入结果 -->
                                        <div x-show="importResult" class="mt-4 p-3 bg-green-50 border border-green-200 rounded-md">
                                            <div class="flex items-center">
                                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                                <span class="text-sm text-green-800" x-text="importResult?.message"></span>
                                            </div>
                                            <div class="mt-2 text-xs text-green-700">
                                                恢复文件: <span x-text="importResult?.files_restored"></span> 个 |
                                                恢复表: <span x-text="importResult?.tables_restored"></span> 个
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 关于 -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="px-6 py-4 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">关于</h3>
                                <p class="mt-1 text-sm text-gray-600">Pinchy - Python、Node.js脚本调度执行系统</p>
                            </div>
                            <div class="p-6">
                                <div class="space-y-6">
                                    <!-- 系统信息 -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">项目作者</label>
                                            <div class="mt-1 flex items-center space-x-3">
                                                <a href="https://github.com/3ixi" target="_blank" class="text-sm text-blue-600 hover:text-blue-800 underline">3iXi</a>
                                                <span class="text-sm text-gray-900">| KoKoNu7</span>
                                                <a href="https://github.com/3iXi/Pinchy" target="_blank"
                                                   class="inline-flex items-center px-3 py-1 border border-gray-300 rounded-md text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                                                    <i class="fab fa-github mr-1"></i>
                                                    项目主页
                                                    <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                                                </a>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">系统创建时间</label>
                                            <p class="mt-1 text-sm text-gray-900" x-text="versionInfo && versionInfo.created_at ? formatDateOnly(versionInfo.created_at) : '加载中...'"></p>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">法律文档</label>
                                            <div class="mt-1 flex items-center space-x-3">
                                                <button @click="showAgreementModal = true"
                                                    class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-file-contract mr-2"></i>
                                                用户协议
                                            </button>
                                            <button @click="showTermsModal = true"
                                                    class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-file-alt mr-2"></i>
                                                服务条款
                                            </button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">数据收集说明</label>
                                            <div class="mt-1 flex items-center space-x-3">
                                            <button @click="showDataCollectionModal = true"
                                                    class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-shield-alt mr-2"></i>
                                                数据收集说明
                                            </button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 任务日志模态框 -->
    <div x-show="showTaskLogModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="closeTaskLogModal()"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full relative max-h-[90vh] flex flex-col">
                <div class="px-6 py-4 border-b border-gray-200 flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">
                            <span x-text="currentTaskLog ? currentTaskLog.name : ''"></span> - 执行日志
                        </h3>
                        <button @click="closeTaskLogModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div x-show="currentTaskLog" class="mt-2 text-sm text-gray-500">
                        <span x-show="taskLogLoading">正在加载日志...</span>
                        <span x-show="!taskLogLoading && taskLogData">
                            状态: <span :class="taskLogData && taskLogData.status === 'success' ? 'text-green-600' : taskLogData && taskLogData.status === 'failed' ? 'text-red-600' : 'text-yellow-600'"
                                      x-text="taskLogData ? getStatusText(taskLogData.status) : ''"></span>
                            <span x-show="taskLogData && taskLogData.start_time && taskLogData.end_time"> | 耗时: <span x-text="taskLogData && taskLogData.start_time && taskLogData.end_time ? calculateTaskDuration(taskLogData.start_time, taskLogData.end_time) : ''"></span></span>
                            <br>
                            <span x-show="taskLogData && taskLogData.start_time">开始: <span x-text="taskLogData ? formatDateTime(taskLogData.start_time) : ''"></span></span>
                            <span x-show="taskLogData && taskLogData.end_time"> | 结束: <span x-text="taskLogData ? formatDateTime(taskLogData.end_time) : ''"></span></span>
                        </span>
                        <span x-show="!taskLogLoading && !taskLogData" class="text-gray-400">该任务暂无执行记录</span>
                    </div>
                </div>
                <div class="flex-1 overflow-hidden flex flex-col">
                    <div x-show="taskLogLoading" class="flex-1 flex items-center justify-center">
                        <div class="text-center text-gray-500">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>加载中...</p>
                        </div>
                    </div>
                    <div x-show="!taskLogLoading && !taskLogData" class="flex-1 flex items-center justify-center">
                        <div class="text-center text-gray-400">
                            <i class="fas fa-file-alt text-4xl mb-4"></i>
                            <p>该任务暂无执行记录</p>
                        </div>
                    </div>
                    <div x-show="!taskLogLoading && taskLogData" class="flex-1 overflow-hidden flex flex-col">
                        <!-- 日志内容标签页 -->
                        <div class="border-b border-gray-200 flex-shrink-0">
                            <nav class="-mb-px flex">
                                <button @click="taskLogTab = 'output'"
                                        :class="taskLogTab === 'output' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-4 border-b-2 font-medium text-sm">
                                    标准输出
                                    <span x-show="taskLogData && taskLogData.output" class="ml-1 text-xs bg-blue-100 text-blue-800 px-1 rounded">有内容</span>
                                </button>
                                <button @click="taskLogTab = 'error'"
                                        :class="taskLogTab === 'error' ? 'border-red-500 text-red-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-4 border-b-2 font-medium text-sm">
                                    错误输出
                                    <span x-show="taskLogData && taskLogData.error_output" class="ml-1 text-xs bg-red-100 text-red-800 px-1 rounded">有内容</span>
                                </button>
                            </nav>
                        </div>
                        <!-- 日志内容 -->
                        <div class="flex-1 overflow-auto p-4">
                            <div x-show="taskLogTab === 'output'">
                                <div x-show="taskLogData && taskLogData.output">
                                    <pre class="task-log-output bg-gray-900 text-green-400 p-4 rounded text-sm overflow-auto font-mono whitespace-pre-wrap max-h-96" x-text="taskLogData ? taskLogData.output : ''"></pre>
                                </div>
                                <div x-show="!taskLogData || !taskLogData.output" class="text-center text-gray-400 py-8">
                                    <div x-show="currentTaskLog && isTaskRunning(currentTaskLog.id)" class="flex items-center justify-center">
                                        <i class="fas fa-spinner fa-spin mr-2"></i>
                                        任务正在运行中，等待输出...
                                    </div>
                                    <div x-show="!currentTaskLog || !isTaskRunning(currentTaskLog.id)">
                                        暂无标准输出
                                    </div>
                                </div>
                            </div>
                            <div x-show="taskLogTab === 'error'">
                                <div x-show="taskLogData && taskLogData.error_output">
                                    <pre class="bg-red-900 text-red-100 p-4 rounded text-sm overflow-auto font-mono whitespace-pre-wrap" x-text="taskLogData ? taskLogData.error_output : ''"></pre>
                                </div>
                                <div x-show="!taskLogData || !taskLogData.error_output" class="text-center text-gray-400 py-8">
                                    暂无错误输出
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex-shrink-0">
                    <div class="flex justify-between items-center">
                        <div x-show="currentTaskLog && isTaskRunning(currentTaskLog.id)" class="flex items-center text-yellow-600">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            <span>任务正在运行中，日志将实时更新</span>
                        </div>
                        <div class="flex space-x-3">
                            <button @click="refreshTaskLog()"
                                    class="px-4 py-2 btn-primary text-white rounded-md">
                                <i class="fas fa-sync-alt mr-1"></i>
                                刷新
                            </button>
                            <button @click="closeTaskLogModal()"
                                    class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                                关闭
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 任务模态框 -->
    <div x-show="showTaskModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showTaskModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900" x-text="editingTask ? '编辑任务' : '创建任务'"></h3>
                </div>
                <form @submit.prevent="saveTask()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">任务名称</label>
                        <input type="text" x-model="taskForm.name" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">描述</label>
                        <textarea x-model="taskForm.description"
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">脚本路径</label>
                        <input type="text" x-model="taskForm.script_path" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                               placeholder="例如: script.py">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">脚本类型</label>
                        <select x-model="taskForm.script_type" required
                                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                            <option value="python">Python</option>
                            <option value="nodejs">Node.js</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">任务分组</label>
                        <div class="mt-1 space-y-2">
                            <select x-model="taskForm.group_name" required
                                    class="w-full border border-gray-300 rounded-md px-3 py-2">
                                <option value="默认">默认</option>
                                <template x-for="group in taskGroups.filter(g => g !== '默认')" :key="group">
                                    <option :value="group" x-text="group"></option>
                                </template>
                            </select>
                            <div class="flex space-x-2">
                                <input type="text" x-model="newGroupName" placeholder="新分组名"
                                       class="flex-1 border border-gray-300 rounded-md px-3 py-2">
                                <button type="button" @click="createNewGroup()"
                                        class="px-4 py-2 bg-green-500 text-white rounded-md whitespace-nowrap text-sm hover:bg-green-600 transition-colors">
                                    新建
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Cron表达式</label>
                        <div class="mt-1 flex space-x-2">
                            <input type="text" x-model="taskForm.cron_expression" required
                                   class="flex-1 border border-gray-300 rounded-md px-3 py-2"
                                   placeholder="5字段: 0 */1 * * * (每小时) 或 6字段: 0 0 */1 * * * (每小时0分0秒)">
                            <button type="button" @click="showCronGeneratorModal = true"
                                    class="px-4 py-2 btn-primary text-white rounded-md whitespace-nowrap">
                                Cron生成
                            </button>
                        </div>
                        <div class="mt-1 text-xs text-gray-500">
                            支持传统5字段格式和秒级6字段格式。6字段格式: 秒 分 时 日 月 周
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showTaskModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Cron表达式生成器模态框 -->
    <div x-show="showCronGeneratorModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showCronGeneratorModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Cron表达式生成器</h3>
                </div>
                <div class="p-6 space-y-6">
                    <!-- 秒级精度开关 -->
                    <div>
                        <label class="flex items-center space-x-2 mb-4">
                            <input type="checkbox" x-model="enableSeconds" @change="toggleSecondsMode()"
                                   class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <span class="text-sm font-medium text-gray-700">启用秒级精度</span>
                            <span class="text-xs text-gray-500">(支持6字段CRON表达式)</span>
                        </label>
                    </div>

                    <!-- 预设模板 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">常用模板</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button @click="applyCronTemplate('0 0 * * *')" type="button"
                                    class="text-left p-3 border border-gray-300 rounded-md hover:bg-gray-50">
                                <div class="font-medium">每天执行</div>
                                <div class="text-sm text-gray-500">0 0 * * *</div>
                                <div class="text-xs text-gray-400">每天凌晨执行</div>
                            </button>
                            <button @click="applyCronTemplate('0 */1 * * *')" type="button"
                                    class="text-left p-3 border border-gray-300 rounded-md hover:bg-gray-50">
                                <div class="font-medium">每小时执行</div>
                                <div class="text-sm text-gray-500">0 */1 * * *</div>
                                <div class="text-xs text-gray-400">每小时的0分执行</div>
                            </button>
                            <button @click="applyCronTemplate('*/10 * * * *')" type="button"
                                    class="text-left p-3 border border-gray-300 rounded-md hover:bg-gray-50">
                                <div class="font-medium">每10分钟执行</div>
                                <div class="text-sm text-gray-500">*/10 * * * *</div>
                                <div class="text-xs text-gray-400">每10分钟执行一次</div>
                            </button>
                            <button @click="applyCronTemplate('0 0 1 * *')" type="button"
                                    class="text-left p-3 border border-gray-300 rounded-md hover:bg-gray-50">
                                <div class="font-medium">每月执行</div>
                                <div class="text-sm text-gray-500">0 0 1 * *</div>
                                <div class="text-xs text-gray-400">每月1日凌晨执行</div>
                            </button>
                            <!-- 秒级模板 -->
                            <template x-if="enableSeconds">
                                <button @click="applyCronTemplate('*/30 * * * * *')" type="button"
                                        class="text-left p-3 border border-blue-300 rounded-md hover:bg-blue-50 bg-blue-25">
                                    <div class="font-medium text-blue-800">每30秒执行</div>
                                    <div class="text-sm text-blue-600">*/30 * * * * *</div>
                                    <div class="text-xs text-blue-400">每30秒执行一次</div>
                                </button>
                            </template>
                            <template x-if="enableSeconds">
                                <button @click="applyCronTemplate('0 */5 * * * *')" type="button"
                                        class="text-left p-3 border border-blue-300 rounded-md hover:bg-blue-50 bg-blue-25">
                                    <div class="font-medium text-blue-800">每5分钟整点</div>
                                    <div class="text-sm text-blue-600">0 */5 * * * *</div>
                                    <div class="text-xs text-blue-400">每5分钟的0秒执行</div>
                                </button>
                            </template>
                        </div>
                    </div>

                    <!-- 自定义设置 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">自定义设置</label>
                        <div :class="enableSeconds ? 'grid grid-cols-6 gap-3' : 'grid grid-cols-5 gap-4'">
                            <!-- 秒 (仅在启用秒级精度时显示) -->
                            <template x-if="enableSeconds">
                                <div>
                                    <label class="block text-xs font-medium text-blue-600 mb-1">秒</label>
                                    <select x-model="cronForm.second" @change="updateCronExpression()"
                                            class="w-full text-sm border border-blue-300 rounded px-2 py-1">
                                        <option value="*">每秒</option>
                                        <option value="*/5">每5秒</option>
                                        <option value="*/10">每10秒</option>
                                        <option value="*/15">每15秒</option>
                                        <option value="*/30">每30秒</option>
                                        <template x-for="i in 60" :key="i">
                                            <option :value="i-1" x-text="i-1"></option>
                                        </template>
                                    </select>
                                </div>
                            </template>
                            <!-- 分钟 -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">分钟</label>
                                <select x-model="cronForm.minute" @change="updateCronExpression()"
                                        class="w-full text-sm border border-gray-300 rounded px-2 py-1">
                                    <option value="*">每分钟</option>
                                    <option value="*/10">每10分钟</option>
                                    <option value="*/30">每30分钟</option>
                                    <template x-for="i in 60" :key="i">
                                        <option :value="i-1" x-text="i-1"></option>
                                    </template>
                                </select>
                            </div>
                            <!-- 小时 -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">小时</label>
                                <select x-model="cronForm.hour" @change="updateCronExpression()"
                                        class="w-full text-sm border border-gray-300 rounded px-2 py-1">
                                    <option value="*">每小时</option>
                                    <option value="*/2">每2小时</option>
                                    <option value="*/4">每4小时</option>
                                    <option value="*/6">每6小时</option>
                                    <option value="*/12">每12小时</option>
                                    <template x-for="i in 24" :key="i">
                                        <option :value="i-1" x-text="i-1"></option>
                                    </template>
                                </select>
                            </div>
                            <!-- 日 -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">日</label>
                                <select x-model="cronForm.day" @change="updateCronExpression()"
                                        class="w-full text-sm border border-gray-300 rounded px-2 py-1">
                                    <option value="*">每天</option>
                                    <template x-for="i in 31" :key="i">
                                        <option :value="i" x-text="i"></option>
                                    </template>
                                </select>
                            </div>
                            <!-- 月 -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">月</label>
                                <select x-model="cronForm.month" @change="updateCronExpression()"
                                        class="w-full text-sm border border-gray-300 rounded px-2 py-1">
                                    <option value="*">每月</option>
                                    <option value="1">1月</option>
                                    <option value="2">2月</option>
                                    <option value="3">3月</option>
                                    <option value="4">4月</option>
                                    <option value="5">5月</option>
                                    <option value="6">6月</option>
                                    <option value="7">7月</option>
                                    <option value="8">8月</option>
                                    <option value="9">9月</option>
                                    <option value="10">10月</option>
                                    <option value="11">11月</option>
                                    <option value="12">12月</option>
                                </select>
                            </div>
                            <!-- 星期 -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">星期</label>
                                <select x-model="cronForm.weekday" @change="updateCronExpression()"
                                        class="w-full text-sm border border-gray-300 rounded px-2 py-1">
                                    <option value="*">每天</option>
                                    <option value="0">周日</option>
                                    <option value="1">周一</option>
                                    <option value="2">周二</option>
                                    <option value="3">周三</option>
                                    <option value="4">周四</option>
                                    <option value="5">周五</option>
                                    <option value="6">周六</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 生成的表达式 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">生成的Cron表达式</label>
                        <div class="bg-gray-100 p-3 rounded-md">
                            <code class="text-lg font-mono" x-text="generatedCron"></code>
                        </div>
                        <div class="mt-2 text-sm text-gray-600" x-text="getCronDescription(generatedCron)"></div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button type="button" @click="showCronGeneratorModal = false"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                        取消
                    </button>
                    <button type="button" @click="applyCronExpression()"
                            class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                        应用表达式
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 文件上传模态框 -->
    <div x-show="showUploadModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showUploadModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">上传文件</h3>
                </div>
                <form @submit.prevent="uploadFile()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">选择文件</label>
                        <input type="file" @change="handleFileSelect" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showUploadModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            上传
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 创建目录模态框 -->
    <div x-show="showCreateDirModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showCreateDirModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">创建目录</h3>
                </div>
                <form @submit.prevent="createDirectory()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">目录名称</label>
                        <input type="text" x-model="newDirName" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showCreateDirModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-md">
                            创建
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 新建文本模态框 -->
    <div x-show="showCreateTextModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 py-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showCreateTextModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full relative max-h-[90vh] overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">新建文本文件</h3>
                </div>
                <form @submit.prevent="createTextFile()">
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">文件名</label>
                            <input type="text" x-model="textFileForm.filename" required
                                   class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                   placeholder="例如: script.py, config.txt, README.md">
                            <p class="text-xs text-gray-500 mt-1">支持各种文本格式：.py, .js, .txt, .md, .json, .yaml, .yml, .xml, .html, .css, .sql 等</p>
                        </div>
                    </div>
                    <div class="px-6 pb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">文件内容</label>
                        <textarea x-model="textFileForm.content"
                                  class="w-full h-96 border border-gray-300 rounded-md px-3 py-2 font-mono text-sm resize-none"
                                  placeholder="请输入文件内容..."
                                  style="height: 400px;"></textarea>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                        <button type="button" @click="showCreateTextModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-md">
                            <i class="fas fa-plus mr-2"></i>
                            创建文件
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 环境变量模态框 -->
    <div x-show="showEnvModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showEnvModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900" x-text="editingEnv ? '编辑环境变量' : '添加环境变量'"></h3>
                </div>
                <form @submit.prevent="saveEnv()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">变量名</label>
                        <input type="text" x-model="envForm.key" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">变量值</label>
                        <textarea x-model="envForm.value" required rows="4"
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                  placeholder="支持多行输入..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">描述</label>
                        <textarea x-model="envForm.description"
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showEnvModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 通知配置模态框 -->
    <div x-show="showNotificationConfigModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showNotificationConfigModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900" x-text="editingNotificationConfig ? '编辑通知配置' : '添加通知配置'"></h3>
                </div>
                <form @submit.prevent="saveNotificationConfig()">
                    <div class="px-6 py-4 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">通知类型</label>
                            <select x-model="notificationConfigForm.name"
                                    class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                    required>
                                <option value="">请选择通知类型</option>
                                <option value="email">邮箱通知</option>
                                <option value="pushplus">PushPlus</option>
                                <option value="wxpusher">WxPusher</option>
                                <option value="telegram">Telegram机器人</option>
                                <option value="wecom">企微WebHook</option>
                                <option value="wecom_app">企微应用通知</option>
                                <option value="serverchan">Server酱</option>
                                <option value="dingtalk">钉钉机器人</option>
                                <option value="bark">Bark</option>
                            </select>
                        </div>

                        <!-- 邮箱配置 -->
                        <div x-show="notificationConfigForm.name === 'email'" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">SMTP服务器</label>
                                    <input type="text" x-model="notificationConfigForm.config.smtp_server"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                           placeholder="smtp.gmail.com">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">SMTP端口</label>
                                    <input type="number" x-model="notificationConfigForm.config.smtp_port"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                           placeholder="587">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">用户名</label>
                                    <input type="text" x-model="notificationConfigForm.config.username"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">密码</label>
                                    <input type="password" x-model="notificationConfigForm.config.password"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">发件人邮箱</label>
                                    <input type="email" x-model="notificationConfigForm.config.from_email"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">收件人邮箱</label>
                                    <input type="email" x-model="notificationConfigForm.config.to_email"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                </div>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" x-model="notificationConfigForm.config.use_tls"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <label class="ml-2 text-sm text-gray-700">使用TLS加密</label>
                            </div>
                        </div>

                        <!-- PushPlus配置 -->
                        <div x-show="notificationConfigForm.name === 'pushplus'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Token</label>
                                <input type="text" x-model="notificationConfigForm.config.token"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入PushPlus Token">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">模板类型</label>
                                <select x-model="notificationConfigForm.config.template"
                                        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                    <option value="html">HTML</option>
                                    <option value="txt">纯文本</option>
                                    <option value="json">JSON</option>
                                    <option value="markdown">Markdown</option>
                                </select>
                            </div>
                        </div>

                        <!-- WxPusher配置 -->
                        <div x-show="notificationConfigForm.name === 'wxpusher'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">App Token</label>
                                <input type="text" x-model="notificationConfigForm.config.app_token"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入WxPusher App Token">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">用户UID</label>
                                <textarea x-model="notificationConfigForm.config.uids_text"
                                          class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                          rows="3"
                                          placeholder="请输入用户UID，多个UID用逗号或换行分隔&#10;例如：&#10;UID_xxx&#10;UID_yyy"></textarea>
                                <p class="text-xs text-gray-500 mt-1">支持多个UID，用逗号或换行分隔</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">内容类型</label>
                                <select x-model="notificationConfigForm.config.content_type"
                                        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                    <option :value="1">文字</option>
                                    <option :value="2">HTML</option>
                                    <option :value="3">Markdown</option>
                                </select>
                            </div>
                        </div>

                        <!-- Telegram配置 -->
                        <div x-show="notificationConfigForm.name === 'telegram'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Bot Token</label>
                                <input type="text" x-model="notificationConfigForm.config.bot_token"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入Telegram Bot Token">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Chat ID</label>
                                <input type="text" x-model="notificationConfigForm.config.chat_id"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入Chat ID">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">解析模式</label>
                                <select x-model="notificationConfigForm.config.parse_mode"
                                        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                    <option value="">纯文本</option>
                                    <option value="HTML">HTML</option>
                                    <option value="Markdown">Markdown</option>
                                </select>
                            </div>
                        </div>

                        <!-- 企业微信WebHook配置 -->
                        <div x-show="notificationConfigForm.name === 'wecom'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Webhook URL</label>
                                <input type="url" x-model="notificationConfigForm.config.webhook_url"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入企业微信机器人Webhook URL">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">消息类型</label>
                                <select x-model="notificationConfigForm.config.msg_type"
                                        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                    <option value="text">文本</option>
                                    <option value="markdown">Markdown</option>
                                </select>
                            </div>
                        </div>

                        <!-- 企业微信应用通知配置 -->
                        <div x-show="notificationConfigForm.name === 'wecom_app'" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">企业ID (CorpID)</label>
                                    <input type="text" x-model="notificationConfigForm.config.corp_id"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                           placeholder="请输入企业ID">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">应用ID (AgentID)</label>
                                    <input type="text" x-model="notificationConfigForm.config.agent_id"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                           placeholder="请输入应用ID">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">应用密钥 (Secret)</label>
                                <input type="password" x-model="notificationConfigForm.config.corp_secret"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入应用密钥">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">接收用户</label>
                                <input type="text" x-model="notificationConfigForm.config.to_user"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="@all 或指定用户ID，多个用|分隔">
                                <p class="text-xs text-gray-500 mt-1">@all表示发送给所有用户，或输入具体用户ID</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">消息类型</label>
                                <select x-model="notificationConfigForm.config.msg_type"
                                        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                    <option value="text">文本</option>
                                    <option value="markdown">Markdown</option>
                                </select>
                            </div>
                        </div>

                        <!-- Server酱配置 -->
                        <div x-show="notificationConfigForm.name === 'serverchan'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Send Key</label>
                                <input type="text" x-model="notificationConfigForm.config.send_key"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入Server酱Send Key">
                            </div>
                        </div>

                        <!-- 钉钉机器人配置 -->
                        <div x-show="notificationConfigForm.name === 'dingtalk'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Webhook URL</label>
                                <input type="url" x-model="notificationConfigForm.config.webhook_url"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入钉钉机器人Webhook URL">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">签名密钥 (可选)</label>
                                <input type="text" x-model="notificationConfigForm.config.secret"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入签名密钥（如果启用了签名验证）">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">消息类型</label>
                                <select x-model="notificationConfigForm.config.msg_type"
                                        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                    <option value="text">文本</option>
                                    <option value="markdown">Markdown</option>
                                </select>
                            </div>
                        </div>

                        <!-- Bark配置 -->
                        <div x-show="notificationConfigForm.name === 'bark'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Key</label>
                                <input type="text" x-model="notificationConfigForm.config.device_key"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="请输入Bark Key">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">服务器地址
                                    <a href="#" class="text-blue-600 hover:text-blue-800 text-sm font-normal ml-2" 
                                        onclick="document.querySelector('input[x-model=\'notificationConfigForm.config.server_url\']').value='https://api.day.app'; return false;">
                                        填入默认服务器
                                    </a>
                                </label>
                                <input type="url" x-model="notificationConfigForm.config.server_url"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="https://api.day.app">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">提示音 (可选)</label>
                                    <input type="text" x-model="notificationConfigForm.config.sound"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                           placeholder="例如: alarm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">分组 (可选)</label>
                                    <input type="text" x-model="notificationConfigForm.config.group"
                                           class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                           placeholder="例如: Pinchy">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                        <button type="button" @click="showNotificationConfigModal = false"
                                class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 btn-primary text-white rounded-md">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 包安装模态框 -->
    <div x-show="showPackageModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showPackageModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">安装包</h3>
                </div>
                <form @submit.prevent="installPackage()" class="p-6 space-y-4">
                    <!-- 环境状态显示 -->
                    <div x-show="environmentCheck" class="bg-gray-50 rounded-lg p-4 space-y-3">
                        <h4 class="text-sm font-medium text-gray-700">环境状态</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="flex items-center space-x-2">
                                <div :class="environmentCheck && environmentCheck.python && environmentCheck.python.installed ? 'w-2 h-2 bg-green-500 rounded-full' : 'w-2 h-2 bg-red-500 rounded-full'"></div>
                                <span class="text-gray-600">Python</span>
                                <span x-show="environmentCheck && environmentCheck.python && environmentCheck.python.installed"
                                      class="text-green-600 text-xs"
                                      x-text="environmentCheck && environmentCheck.python ? environmentCheck.python.version : ''"></span>
                                <span x-show="environmentCheck && environmentCheck.python && !environmentCheck.python.installed"
                                      class="text-red-600 text-xs">未安装</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div :class="environmentCheck && environmentCheck.nodejs && environmentCheck.nodejs.installed ? 'w-2 h-2 bg-green-500 rounded-full' : 'w-2 h-2 bg-red-500 rounded-full'"></div>
                                <span class="text-gray-600">Node.js</span>
                                <span x-show="environmentCheck && environmentCheck.nodejs && environmentCheck.nodejs.installed"
                                      class="text-green-600 text-xs"
                                      x-text="environmentCheck && environmentCheck.nodejs ? environmentCheck.nodejs.version : ''"></span>
                                <span x-show="environmentCheck && environmentCheck.nodejs && !environmentCheck.nodejs.installed"
                                      class="text-red-600 text-xs">未安装</span>
                            </div>
                        </div>

                        <!-- 包管理器配置显示 -->
                        <div x-show="packageManagerConfig" class="border-t pt-3">
                            <h5 class="text-xs font-medium text-gray-600 mb-2">当前包管理器</h5>
                            <div class="grid grid-cols-2 gap-4 text-xs">
                                <div class="flex items-center space-x-2">
                                    <i class="fab fa-python text-blue-600"></i>
                                    <span class="text-gray-600">Python:</span>
                                    <span class="font-medium text-blue-600" x-text="packageManagerConfig ? packageManagerConfig.python_package_manager : 'pip'"></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <i class="fab fa-node-js text-green-600"></i>
                                    <span class="text-gray-600">Node.js:</span>
                                    <span class="font-medium text-green-600" x-text="packageManagerConfig ? packageManagerConfig.nodejs_package_manager : 'npm'"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">包类型</label>
                        <select x-model="packageForm.package_type" required
                                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                            <option value="python"
                                    :disabled="environmentCheck && environmentCheck.python && !environmentCheck.python.installed"
                                    x-text="'Python' + (environmentCheck && environmentCheck.python && !environmentCheck.python.installed ? '（环境未安装）' : '')">
                            </option>
                            <option value="nodejs"
                                    :disabled="environmentCheck && environmentCheck.nodejs && !environmentCheck.nodejs.installed"
                                    x-text="'Node.js' + (environmentCheck && environmentCheck.nodejs && !environmentCheck.nodejs.installed ? '（环境未安装）' : '')">
                            </option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">包名称</label>
                        <input type="text" x-model="packageForm.package_name" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                               placeholder="例如: requests">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">版本 (可选)</label>
                        <input type="text" x-model="packageForm.version"
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                               placeholder="例如: 2.28.1">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showPackageModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            安装
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 包安装日志模态框 -->
    <div x-show="showPackageInstallModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full relative max-h-[90vh] flex flex-col">
                <div class="px-6 py-4 border-b border-gray-200 flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">
                            <i class="fas fa-download mr-2 text-blue-600" x-show="packageOperationType === 'install'"></i>
                            <i class="fas fa-trash mr-2 text-red-600" x-show="packageOperationType === 'uninstall'"></i>
                            <span x-text="packageOperationType === 'uninstall' ? '包卸载进度' : '包安装进度'"></span>
                        </h3>
                        <div class="flex items-center space-x-3">
                            <div x-show="packageInstallStatus === 'installing'" class="flex items-center text-blue-600">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                <span class="text-sm" x-text="packageOperationType === 'uninstall' ? '卸载中...' : '安装中...'"></span>
                            </div>
                            <div x-show="packageInstallStatus === 'success'" class="flex items-center text-green-600">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span class="text-sm" x-text="packageOperationType === 'uninstall' ? '卸载成功' : '安装成功'"></span>
                            </div>
                            <div x-show="packageInstallStatus === 'failed'" class="flex items-center text-red-600">
                                <i class="fas fa-times-circle mr-2"></i>
                                <span class="text-sm" x-text="packageOperationType === 'uninstall' ? '卸载失败' : '安装失败'"></span>
                            </div>
                            <button @click="closePackageInstallModal()"
                                    :disabled="packageInstallStatus === 'installing'"
                                    class="text-gray-400 hover:text-gray-600 disabled:opacity-50">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mt-2 text-sm text-gray-600">
                        <span>包类型: </span>
                        <span class="font-medium" x-text="packageInstallInfo.type"></span>
                        <span class="mx-2">|</span>
                        <span>包名: </span>
                        <span class="font-medium" x-text="packageInstallInfo.name"></span>
                        <span x-show="packageInstallInfo.version" class="mx-2">|</span>
                        <span x-show="packageInstallInfo.version">版本: </span>
                        <span x-show="packageInstallInfo.version" class="font-medium" x-text="packageInstallInfo.version"></span>
                    </div>
                </div>

                <div class="flex-1 overflow-hidden flex flex-col">
                    <!-- 安装日志 -->
                    <div class="flex-1 overflow-auto p-4">
                        <div class="bg-gray-900 text-green-400 p-4 rounded text-sm font-mono whitespace-pre-wrap min-h-96 max-h-96 overflow-auto"
                             x-ref="packageLogContainer">
                            <div x-show="packageInstallLogs.length === 0" class="text-gray-500">
                                <span x-text="packageOperationType === 'uninstall' ? '等待卸载开始...' : '等待安装开始...'"></span>
                            </div>
                            <template x-for="log in packageInstallLogs" :key="log.id">
                                <div x-text="log.message"></div>
                            </template>
                            <div x-show="packageInstallStatus === 'installing'" class="text-yellow-400">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                <span x-text="packageOperationType === 'uninstall' ? '正在卸载，请稍候...' : '正在安装，请稍候...'"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="px-6 py-4 border-t border-gray-200 flex-shrink-0">
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            <span x-show="packageInstallStatus === 'installing'" x-text="packageOperationType === 'uninstall' ? '卸载过程中请勿关闭此窗口' : '安装过程中请勿关闭此窗口'"></span>
                            <span x-show="packageInstallStatus === 'success'" class="text-green-600" x-text="packageOperationType === 'uninstall' ? '✓ 卸载完成' : '✓ 安装完成'"></span>
                            <span x-show="packageInstallStatus === 'failed'" class="text-red-600" x-text="packageOperationType === 'uninstall' ? '✗ 卸载失败' : '✗ 安装失败'"></span>
                        </div>
                        <div class="flex space-x-3">
                            <button @click="clearPackageInstallLogs()"
                                    :disabled="packageInstallStatus === 'installing'"
                                    class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 disabled:opacity-50">
                                <i class="fas fa-eraser mr-1"></i>
                                清空日志
                            </button>
                            <button @click="closePackageInstallModal()"
                                    :disabled="packageInstallStatus === 'installing'"
                                    class="px-4 py-2 btn-primary text-white rounded-md disabled:opacity-50">
                                <span x-show="packageInstallStatus === 'installing'" x-text="packageOperationType === 'uninstall' ? '卸载中...' : '安装中...'"></span>
                                <span x-show="packageInstallStatus !== 'installing'">关闭</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改用户名模态框 -->
    <div x-show="showChangeUsernameModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showChangeUsernameModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">修改用户名</h3>
                </div>
                <form @submit.prevent="changeUsername()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">新用户名</label>
                        <input type="text" x-model="usernameForm.new_username" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">当前密码</label>
                        <input type="password" x-model="usernameForm.password" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showChangeUsernameModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 修改密码模态框 -->
    <div x-show="showChangePasswordModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showChangePasswordModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">修改密码</h3>
                </div>
                <form @submit.prevent="changePassword()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">当前密码</label>
                        <input type="password" x-model="passwordForm.old_password" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">新密码</label>
                        <input type="password" x-model="passwordForm.new_password" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">确认新密码</label>
                        <input type="password" x-model="passwordForm.confirm_password" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showChangePasswordModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 文件预览模态框 -->
    <div x-show="showPreviewModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="closePreviewModal()"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full relative max-h-screen overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-lg font-medium text-gray-900" x-text="isEditingFile ? '编辑文件' : '文件预览'"></h3>
                    <div class="flex items-center space-x-2">
                        <button x-show="!isEditingFile && !previewLoading" @click="toggleEditMode()"
                                class="link-primary px-3 py-1 text-sm border theme-primary-border rounded">
                            <i class="fas fa-edit mr-1"></i>编辑
                        </button>
                        <button x-show="isEditingFile" @click="cancelEdit()"
                                class="text-gray-600 hover:text-gray-800 px-3 py-1 text-sm border border-gray-300 rounded">
                            <i class="fas fa-times mr-1"></i>取消
                        </button>
                        <button x-show="isEditingFile" @click="saveFile()" :disabled="saveLoading"
                                class="text-white bg-green-600 hover:bg-green-700 px-3 py-1 text-sm rounded disabled:opacity-50">
                            <i class="fas fa-save mr-1"></i>
                            <span x-show="!saveLoading">保存</span>
                            <span x-show="saveLoading">保存中...</span>
                        </button>
                        <button @click="closePreviewModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6 max-h-96 overflow-y-auto">
                    <div x-show="previewLoading" class="text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        加载中...
                    </div>
                    <div x-show="!previewLoading && (previewContent || isEditingFile)">
                        <div class="mb-4 text-sm text-gray-600 flex items-center justify-between">
                            <div>
                                文件: <span x-text="previewFileData?.name"></span>
                                (<span x-text="formatFileSize(previewFileData?.size || 0)"></span>)
                            </div>
                            <div x-show="isEditingFile" class="text-xs text-gray-500">
                                提示：使用 Ctrl+S 快速保存
                            </div>
                        </div>

                        <!-- 预览模式 -->
                        <div x-show="!isEditingFile" class="bg-gray-100 rounded overflow-hidden">
                            <pre class="text-sm overflow-x-auto" style="margin: 0; padding: 0;"><code x-html="formatPreviewContent(previewContent)" style="display: block; padding: 1rem; line-height: 1.5;"></code></pre>
                        </div>

                        <!-- 编辑模式 -->
                        <div x-show="isEditingFile" class="border border-gray-300 rounded">
                            <textarea x-model="editContent"
                                      @keydown.ctrl.s.prevent="saveFile()"
                                      class="w-full h-96 p-4 font-mono text-sm border-0 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="文件内容..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 重命名模态框 -->
    <div x-show="showRenameModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showRenameModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">重命名</h3>
                </div>
                <form @submit.prevent="confirmRename()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">新名称</label>
                        <input type="text" x-model="renameForm.newName" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showRenameModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 rounded-md">
                            重命名
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 解压文件确认模态框 -->
    <div x-show="showExtractModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showExtractModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">解压文件</h3>
                </div>
                <div class="px-6 py-4">
                    <p class="text-gray-600 mb-4">
                        确定要解压文件 "<span x-text="extractForm.file?.name"></span>" 吗？
                    </p>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-blue-500 mt-0.5 mr-2"></i>
                            <div class="text-sm text-blue-700">
                                <p class="font-medium mb-1">解压说明：</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>支持 zip、tar.gz、gz 格式</li>
                                    <li>文件将解压到当前目录</li>
                                    <li>如有同名文件将被覆盖</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button @click="showExtractModal = false"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                        取消
                    </button>
                    <button @click="confirmExtract()"
                            class="px-4 py-2 text-sm font-medium text-white bg-yellow-600 hover:bg-yellow-700 rounded-md">
                        <i class="fas fa-expand-arrows-alt mr-1"></i>
                        解压
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 分组重命名模态框 -->
    <div x-show="showGroupRenameModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showGroupRenameModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">重命名分组</h3>
                </div>
                <form @submit.prevent="renameGroup()" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">原分组名称</label>
                        <input type="text" x-model="groupRenameForm.oldName" readonly
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">新分组名称</label>
                        <input type="text" x-model="groupRenameForm.newName" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                               placeholder="请输入新的分组名称">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showGroupRenameModal = false"
                                class="px-4 py-2 text-gray-600 hover:text-gray-800">
                            取消
                        </button>
                        <button type="submit"
                                class="btn-primary text-white px-4 py-2 rounded-lg">
                            确认重命名
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 分组删除确认模态框 -->
    <div x-show="showGroupDeleteModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showGroupDeleteModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">删除分组</h3>
                </div>
                <div class="px-6 py-4">
                    <p class="text-gray-600 mb-4">
                        确定要删除分组 "<span x-text="groupDeleteForm.groupName"></span>" 吗？
                    </p>
                    <p class="text-sm text-red-600 font-medium">
                        ⚠️ 警告：此操作将删除该分组下的所有任务，且无法恢复！
                    </p>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button @click="showGroupDeleteModal = false"
                            class="px-4 py-2 text-gray-600 hover:text-gray-800">
                        取消
                    </button>
                    <button @click="deleteGroup()"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">
                        确认删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 停止任务确认模态框 -->
    <div x-show="showStopTaskConfirmModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showStopTaskConfirmModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">停止任务</h3>
                </div>
                <div class="px-6 py-4">
                    <p class="text-gray-600 mb-4">
                        确定要停止任务 "<span x-text="stopTaskTarget?.name"></span>" 吗？
                    </p>
                    <p class="text-sm text-gray-500">
                        系统将首先尝试优雅停止任务，如果5秒后任务仍在运行，将强制结束任务。
                    </p>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button @click="showStopTaskConfirmModal = false"
                            class="px-4 py-2 text-gray-600 hover:text-gray-800">
                        取消
                    </button>
                    <button @click="confirmStopTask()"
                            :disabled="stopTaskLoading"
                            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50">
                        <span x-show="!stopTaskLoading">确定停止</span>
                        <span x-show="stopTaskLoading">
                            <i class="fas fa-spinner fa-spin mr-1"></i>停止中...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 版本升级模态框 -->
    <div x-show="showVersionModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">版本升级信息</h3>
                <button @click="closeVersionModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div class="space-y-6">
                    <!-- 版本信息 -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">当前版本</label>
                            <p class="mt-1 text-lg font-semibold text-gray-900" x-text="versionInfo.current_version"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">最新版本</label>
                            <p class="mt-1 text-lg font-semibold text-green-600" x-text="versionInfo.latest_version"></p>
                        </div>
                    </div>

                    <!-- 升级日期 -->
                    <div x-show="versionInfo.upgrade_date">
                        <label class="block text-sm font-medium text-gray-700">发布日期</label>
                        <p class="mt-1 text-sm text-gray-900" x-text="versionInfo.upgrade_date"></p>
                    </div>

                    <!-- 下载链接 -->
                    <div x-show="versionInfo.download_url">
                        <label class="block text-sm font-medium text-gray-700">下载链接</label>
                        <div class="mt-1 flex items-center space-x-2">
                            <input type="text" :value="versionInfo.download_url" readonly
                                   class="flex-1 border border-gray-300 rounded-md px-3 py-2 bg-gray-50 text-sm">
                            <button @click="copyDownloadUrl()"
                                    class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">
                                <i class="fas fa-copy mr-1"></i>
                                复制
                            </button>
                        </div>
                    </div>

                    <!-- 升级信息 -->
                    <div x-show="versionInfo.upgrade_info">
                        <label class="block text-sm font-medium text-gray-700 mb-2">更新内容</label>
                        <div class="border border-gray-200 rounded-md p-4 bg-gray-50">
                            <div x-html="versionInfo.upgrade_info" class="prose prose-sm max-w-none"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-6 border-t border-gray-200 flex justify-end">
                <button @click="closeVersionModal()"
                        class="btn-primary text-white px-6 py-2 rounded-lg transition-colors">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <!-- 历史版本模态框 -->
    <div x-show="showVersionHistoryModalVisible" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
            <div class="px-6 py-4 border-b border-gray-200 flex-shrink-0">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium text-gray-900">
                        <i class="fas fa-history mr-2"></i>
                        版本历史
                    </h3>
                    <button @click="closeVersionHistoryModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div x-show="versionHistoryLoading" class="text-center py-8 text-gray-500">
                    <i class="fas fa-spinner fa-spin mr-2"></i>
                    加载中...
                </div>
                <div x-show="!versionHistoryLoading && versionHistory.length === 0" class="text-center py-8 text-gray-500">
                    暂无版本历史
                </div>
                <div x-show="!versionHistoryLoading && versionHistory.length > 0" class="space-y-6">
                    <template x-for="version in versionHistory" :key="version.version">
                        <div class="border border-gray-200 rounded-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <h4 class="text-lg font-semibold text-gray-900" x-text="'v' + version.version"></h4>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"
                                          x-text="version.release_date"></span>
                                </div>
                            </div>
                            <p class="text-gray-600 mb-4" x-text="version.description"></p>

                            <!-- 优化和改进 -->
                            <div x-show="version.features && version.features.length > 0" class="mb-4">
                                <h5 class="text-sm font-medium text-green-700 mb-2">
                                    <i class="fas fa-plus-circle mr-1"></i>
                                    优化和改进
                                </h5>
                                <ul class="list-disc list-inside space-y-1 text-sm text-gray-600 ml-4">
                                    <template x-for="feature in version.features" :key="feature">
                                        <li x-text="feature"></li>
                                    </template>
                                </ul>
                            </div>

                            <!-- 修复内容 -->
                            <div x-show="version.bug_fixes && version.bug_fixes.length > 0">
                                <h5 class="text-sm font-medium text-orange-700 mb-2">
                                    <i class="fas fa-bug mr-1"></i>
                                    修复内容
                                </h5>
                                <ul class="list-disc list-inside space-y-1 text-sm text-gray-600 ml-4">
                                    <template x-for="fix in version.bug_fixes" :key="fix">
                                        <li x-text="fix"></li>
                                    </template>
                                </ul>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex-shrink-0 flex justify-end">
                <button @click="closeVersionHistoryModal()"
                        class="btn-primary text-white px-6 py-2 rounded-lg transition-colors">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <!-- 用户协议模态框 -->
    <div x-show="showAgreementModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">用户协议</h3>
                <button @click="showAgreementModal = false" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <!-- 协议内容 -->
                <div class="prose prose-sm max-w-none">
                    <!-- Header -->
                    <header class="mb-8 text-center border-b pb-6">
                        <h1 class="text-2xl font-bold text-gray-900 mb-2">Pinchy（大夹夹）脚本调度执行系统</h1>
                        <h2 class="text-xl font-semibold text-red-600">最终用户许可协议</h2>
                        <div class="mt-4 text-sm text-gray-500">
                            <p><strong>协议版本：</strong>v1.1 Self-Hosted</p>
                            <p><strong>作者：</strong>3iXi</p>
                            <p><strong>生效日期：</strong>用户首次部署系统之日</p>
                        </div>
                    </header>

                    <!-- Important Notice -->
                    <section class="bg-red-50 border-l-4 border-red-400 p-4 rounded mb-6">
                        <h3 class="text-lg font-bold text-red-700 mb-3">❗ 重要法律声明</h3>
                        <p class="mb-3">"Pinchy（大夹夹）脚本调度执行系统"（以下简称"系统"）为<strong>本地化部署工具</strong>，作者（3iXi）仅提供软件程序，<u>不参与任何用户操作行为</u>。</p>
                        <p>您作为部署方，需对系统使用产生的<strong>全部法律责任</strong>负责，包括但不限于：</p>
                        <ul class="list-disc pl-6 mt-2 space-y-1">
                            <li>系统安装环境合规性</li>
                            <li>所有通过本系统执行的脚本行为</li>
                            <li>因使用系统导致的第三方权益侵害</li>
                        </ul>
                    </section>

                    <!-- Section 1 -->
                    <section class="mb-6">
                        <h3 class="text-lg font-bold mb-3 text-gray-900 border-b pb-2">一、协议性质与法律定位</h3>
                        <div class="space-y-3">
                            <p>1.1 本系统为<strong>本地化部署工具</strong>，作者（3iXi）仅提供软件程序，不参与任何用户操作行为。</p>
                            <p>1.2 <strong>您作为部署方，需对以下全部法律责任负责：</strong></p>
                            <div class="bg-gray-100 p-3 rounded text-sm">
                                - 系统安装环境合规性<br>
                                - 所有通过本系统执行的脚本行为<br>
                                - 因使用系统导致的第三方权益侵害
                            </div>
                        </div>
                    </section>

                    <!-- Section 2 -->
                    <section class="mb-6">
                        <h3 class="text-lg font-bold mb-3 text-gray-900 border-b pb-2">二、核心免责声明（重点条款）</h3>
                        <div class="space-y-4">
                            <div class="bg-red-50 p-3 rounded">
                                <h4 class="font-bold text-red-800 mb-2">2.1 作者责任排除</h4>
                                <p>您确认并同意：</p>
                                <ul class="list-disc pl-6 mt-2 space-y-1 text-sm">
                                    <li><strong>作者无法访问</strong>您的服务器、脚本代码、执行日志或任何数据</li>
                                    <li><strong>作者不承担</strong>因违法脚本执行产生的任何法律责任</li>
                            <ul class="list-[circle] pl-6 mt-1">
                                <li>脚本违反《网络安全法》第27条（禁止侵入他人网络）</li>
                                <li>利用脚本功能实施《刑法》第285条（非法控制计算机信息系统）</li>
                                <li>自动签到/爬虫触发《反不正当竞争法》第12条（网络不正当竞争）</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h4 class="font-bold text-yellow-800 mb-2">2.2 自部署风险自担原则</h4>
                    <p>因您自主控制全部硬件与软件环境：</p>
                    <ul class="list-disc pl-6 mt-2 space-y-1">
                        <li>需自行配置防火墙、权限隔离等安全措施</li>
                        <li>因系统漏洞导致的安全事故与作者无关</li>
                        <li>不得以"不知情"为由追究作者责任</li>
                    </ul>
                </div>
            </div>
                    </section>

                    <!-- Section 3 -->
                    <section class="mb-6">
                        <h3 class="text-lg font-bold mb-3 text-gray-900 border-b pb-2">三、用户强制性义务</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold mb-2">3.1 法律合规承诺</h4>
                                <p>您必须保证：</p>
                    <ul class="list-disc pl-6 mt-2 space-y-1">
                        <li>所有定时任务符合部署地、目标服务器所在地法律</li>
                        <li>不将系统用于：
                            <ul class="list-[circle] pl-6 mt-1">
                                <li>绕过网站防护措施（如：验证码破解）</li>
                                <li>高频请求攻击（如：DDoS工具链组件）</li>
                                <li>金融欺诈、虚假交易（如：抢票、刷单）</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">3.2 企业特别条款</h4>
                    <p>若部署于企业环境：</p>
                    <ul class="list-disc pl-6 mt-2 space-y-1">
                        <li>需建立内部审批制度记录脚本用途</li>
                        <li>员工违规行为视为企业主体行为</li>
                        <li>发生法律纠纷时需主动配合司法机关取证</li>
                    </ul>
                </div>
            </div>
        </section>

                    <!-- Section 4 -->
                    <section class="mb-6">
                        <h3 class="text-lg font-bold mb-3 text-gray-900 border-b pb-2">四、版权与知识产权</h3>
                        <div class="space-y-3">
                            <p>4.1 系统版权归属3iXi所有，授权您<strong>非排他性、不可转让的使用权</strong>。</p>
                            <p>4.2 <strong>禁止行为：</strong></p>
                            <ul class="list-disc pl-6 space-y-1 text-sm">
                                <li>反编译、修改核心调度引擎代码</li>
                                <li>将系统用于商业SaaS服务（需另行授权）</li>
                                <li>删除启动日志中的作者版权标识</li>
                            </ul>
                        </div>
                    </section>


        <!-- Section 5 -->
        <section class="mb-8">
            <h3 class="text-2xl font-bold mb-4 text-gray-900 border-b pb-2">五、协议终止与违规后果</h3>
            <div class="space-y-4">
                <div>
                    <h4 class="font-bold mb-2">5.1 作者有权终止授权（通过停止更新/漏洞不修复等方式）</h4>
                    <p>若发现：</p>
                    <ul class="list-disc pl-6 mt-2 space-y-1">
                        <li>用户群体大规模涉及黑产</li>
                        <li>系统被用于地方级、国家级新闻通报的违法事件</li>
                        <li>持续违反本协议核心条款</li>
                    </ul>
                </div>

                <div class="bg-red-50 p-4 rounded-lg">
                    <h4 class="font-bold text-red-800 mb-2">5.2 您需承担的违约成本</h4>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>司法机关罚金、第三方索赔</li>
                        <li>企业商誉损失</li>
                        <li>可能面临的刑事责任（参见《刑法》第286条）</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 6 -->
        <section class="mb-8">
            <h3 class="text-2xl font-bold mb-4 text-gray-900 border-b pb-2">六、其他关键条款</h3>
            <div class="space-y-4">
                <div class="bg-gray-100 p-4 rounded-lg">
                    <h4 class="font-bold mb-2">6.1 无担保声明</h4>
                    <p>作者不承诺：</p>
                    <ul class="list-disc pl-6 mt-2 space-y-1">
                        <li>❌系统绝对无漏洞</li>
                        <li>❌多语言脚本引擎兼容所有环境</li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-bold mb-2">6.2 管辖法律</h4>
                    <p>争议解决适用<strong>中华人民共和国法律</strong>，若涉诉应提交<strong>作者所在地法院</strong>审理</p>
                </div>
            </div>
        </section>

        <!-- Legal References Verification -->
        <section class="mt-12 p-6 bg-gray-100 rounded-lg">
            <h3 class="text-xl font-bold mb-4 text-gray-900">法律条款准确性确认</h3>
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="p-2 border text-left">协议引用条款</th>
                        <th class="p-2 border text-left">对应法律依据</th>
                        <th class="p-2 border text-left">有效性确认</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="border-b">
                        <td class="p-2 border">《网络安全法》第27条</td>
                        <td class="p-2 border">禁止侵入他人网络等危害网络安全的活动</td>
                        <td class="p-2 border text-green-600">有效（2023年修正后保留）</td>
                    </tr>
                    <tr class="border-b">
                        <td class="p-2 border">《刑法》第285条</td>
                        <td class="p-2 border">非法侵入计算机信息系统罪</td>
                        <td class="p-2 border text-green-600">有效（刑法修正案十一未修改）</td>
                    </tr>
                    <tr class="border-b">
                        <td class="p-2 border">《刑法》第286条</td>
                        <td class="p-2 border">破坏计算机信息系统罪</td>
                        <td class="p-2 border text-green-600">有效（2025年现行）</td>
                    </tr>
                    <tr>
                        <td class="p-2 border">《反不正当竞争法》第12条</td>
                        <td class="p-2 border">禁止利用技术手段妨碍破坏网络服务</td>
                        <td class="p-2 border text-green-600">有效（2022年修正后保留）</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Footer -->
        <footer class="mt-12 pt-8 border-t text-sm text-gray-500 text-center">
            <p>© 2025 3iXi - Pinchy 脚本调度执行系统</p>
            <p class="mt-2">用户部署本系统即代表<strong>完全理解并接受</strong>本协议全部条款</p>
            <div class="mt-4 p-4 bg-red-50 rounded-lg inline-block">
                <p class="text-red-600 font-bold">⚠️ 特别注意：违反本协议可能导致民事赔偿及刑事责任</p>
            </div>
        </footer>

                </div>
            </div>
            <div class="px-6 py-1 border-t border-gray-200 flex justify-center">
                <button @click="showAgreementModal = false"
                        class="btn-primary text-white px-4 py-2 rounded-lg transition-colors text-sm">
                    我已阅读并同意
                </button>
            </div>
        </div>
    </div>

    <!-- 服务条款模态框 -->
    <div x-show="showTermsModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">服务条款</h3>
                <button @click="showTermsModal = false" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <!-- 服务条款内容 -->
                <div class="prose prose-sm max-w-none">
                    <!-- Header -->
                    <header class="mb-8 text-center border-b pb-6">
                        <h1 class="text-2xl font-bold text-gray-900 mb-2">Pinchy（大夹夹）脚本调度执行系统</h1>
                        <h2 class="text-xl font-semibold text-blue-600">服务条款</h2>
                        <div class="mt-4 text-sm text-gray-500">
                            <p><strong>条款版本：</strong>v1.0 Self-Hosted</p>
                            <p><strong>最后更新：</strong>2025年6月11日</p>
                            <p class="mt-2 text-red-500">⚠️ 本条款与《最终用户许可协议》（EULA）具有同等法律效力</p>
                        </div>
                    </header>

                    <!-- Service Definition -->
                    <section class="mb-8 bg-white p-4 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-bold mb-3 text-blue-800 border-b pb-2">第一条 服务定义</h3>
                        <div class="space-y-3">
                            <p>1.1 Pinchy（大夹夹）是由 <strong>3iXi</strong> 开发的<mark class="bg-yellow-100 px-1">本地化部署的脚本任务调度系统</mark>，提供以下核心功能：</p>
                            <ul class="list-disc pl-6 space-y-1 text-sm">
                                <li>通过Cron表达式定时执行Python/Node.js脚本</li>
                                <li>任务依赖管理与日志记录</li>
                                <li>基础的任务状态监控</li>
                            </ul>
                            <div class="mt-3 p-3 bg-blue-50 rounded-lg text-sm">
                                <strong>法律定位：</strong>本产品属于<u>工具软件</u>，作者不提供：
                                <ul class="list-disc pl-6 mt-1">
                                    <li>云服务或SaaS平台</li>
                                    <li>任何形式的技术支持服务</li>
                                    <li>用户行为的监管能力</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    <!-- Usage Policy -->
                    <section class="mb-8 bg-white p-4 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-bold mb-3 text-blue-800 border-b pb-2">第二条 使用政策</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold mb-2 text-gray-700">2.1 合规要求</h4>
                                <p class="text-sm">您承诺遵守：</p>
                                <ul class="list-disc pl-6 mt-2 space-y-1 text-sm">
                                    <li>《中华人民共和国数据安全法》关于数据处理的规定</li>
                                    <li>《个人信息保护法》对敏感信息的保护要求</li>
                                    <li>其他适用的行业规范（如金融、医疗等领域特殊规定）及中国境内有效法律法规</li>
                                </ul>
                            </div>

                            <div class="bg-red-50 p-3 rounded-lg">
                                <h4 class="font-bold text-red-700 mb-2">2.2 绝对禁止行为</h4>
                                <p class="text-sm">包括但不限于：</p>
                                <ul class="list-disc pl-6 mt-2 space-y-1 text-sm">
                                    <li>利用系统漏洞进行<b>数字货币挖矿</b></li>
                                    <li>作为<b>网络攻击工具链</b>的组成部分</li>
                                    <li>自动化操作<b>赌博/色情/暴恐</b>相关平台</li>
                                    <li>违反《最终用户许可协议》第3.1条的任何行为</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    <!-- Intellectual Property -->
                    <section class="mb-8 bg-white p-4 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-bold mb-3 text-blue-800 border-b pb-2">第三条 知识产权</h3>
                        <div class="space-y-3">
                            <p class="text-sm">3.1 您获得的授权范围：</p>
                            <div class="bg-green-50 p-3 rounded-lg">
                                <table class="w-full text-sm">
                                    <tr class="border-b">
                                        <td class="py-2 font-medium">授权类型</td>
                                        <td class="py-2 font-medium">允许行为</td>
                                        <td class="py-2 font-medium">禁止行为</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2">基础使用权</td>
                                        <td class="py-2">安装、执行、配置</td>
                                        <td class="py-2 text-red-600">商业转售</td>
                                    </tr>
                                    <tr>
                                        <td class="py-2">代码处理</td>
                                        <td class="py-2">前端界面二次开发</td>
                                        <td class="py-2 text-red-600">逆向工程核心调度模块</td>
                                    </tr>
                                </table>
                            </div>
                            <p class="text-sm">3.2 您独立开发的脚本代码知识产权归您所有，但与Pinchy系统的集成方式受本条款约束。</p>
                        </div>
                    </section>

                    <!-- Liability -->
                    <section class="mb-8 bg-white p-4 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-bold mb-3 text-blue-800 border-b pb-2">第四条 责任限制</h3>
                        <div class="space-y-3">
                            <div class="bg-yellow-50 p-3 rounded-lg">
                                <h4 class="font-bold text-yellow-800 mb-2">4.1 作者免责声明</h4>
                                <p class="text-sm">由于系统的自部署特性：</p>
                                <ul class="list-disc pl-6 mt-2 space-y-1 text-sm">
                                    <li>作者<strong>不保证</strong>系统在所有环境下100%可用</li>
                                    <li>因硬件故障导致的任务失败需您自行恢复</li>
                                    <li>系统漏洞造成的损失赔偿上限为<u>软件购买费用的100%</u></li>
                                </ul>
                            </div>
                            <p class="text-sm">4.2 您理解并同意：系统可能因以下不可抗力无法运行：</p>
                            <ul class="list-disc pl-6 mt-2 space-y-1 text-sm">
                                <li>操作系统升级导致的兼容性问题</li>
                                <li>杀毒软件误判为恶意程序</li>
                                <li>Python/Node.js运行时环境变更（包括其依赖运行时造成的兼容性问题）</li>
                            </ul>
                        </div>
                    </section>

                    <!-- Updates & Termination -->
                    <section class="mb-8 bg-white p-4 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-bold mb-3 text-blue-800 border-b pb-2">第五条 更新与终止</h3>
                        <div class="space-y-3">
                            <p class="text-sm">5.1 更新政策：</p>
                            <ul class="list-disc pl-6 space-y-1 text-sm">
                                <li>作者有权<strong>停止维护</strong>旧版本（提前30天公告）</li>
                                <li>安全更新会通过GitHub Releases推送</li>
                                <li>您有义务及时更新到安全版本</li>
                            </ul>

                            <div class="bg-red-50 p-3 rounded-lg mt-3">
                                <h4 class="font-bold text-red-700 mb-2">5.2 服务终止</h4>
                                <p class="text-sm">作者可能采取以下措施而不承担违约责任：</p>
                                <ul class="list-disc pl-6 mt-2 space-y-1 text-sm">
                                    <li>对违法用户<strong>拒绝提供后续更新支持</strong></li>
                                    <li>在代码仓库发布<strong>漏洞警告但不提供补丁</strong></li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    <!-- Governing Law -->
                    <section class="mb-8 bg-white p-4 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-bold mb-3 text-blue-800 border-b pb-2">第六条 法律适用</h3>
                        <div class="space-y-3">
                            <p class="text-sm">6.1 本条款受<strong>中华人民共和国法律</strong>管辖，排除：</p>
                            <ul class="list-disc pl-6 space-y-1 text-sm">
                                <li>《联合国国际货物销售合同公约》</li>
                                <li>冲突法规范指引的其他司法管辖区法律</li>
                            </ul>
                            <p class="text-sm">6.2 争议解决通过<strong>作者所在地法院诉讼</strong>解决。</p>
                        </div>
                    </section>

                        <div class="mt-6 p-3 bg-blue-50 rounded-lg text-center">
                            <p class="text-blue-800 font-medium">继续使用Pinchy系统即表示您<strong>完全理解并接受</strong>本服务条款的所有规定</p>
                        </div>
                </div>
            </div>
            <div class="px-6 py-1 border-t border-gray-200 flex justify-center">
                <button @click="showTermsModal = false"
                        class="btn-primary text-white px-4 py-2 rounded-lg transition-colors text-sm">
                    我已阅读并同意
                </button>
            </div>
        </div>
    </div>

    <!-- 接口调试配置模态框 -->
    <div x-show="showDebugConfigModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showDebugConfigModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full relative max-h-[90vh] overflow-y-auto">
                <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900" x-text="editingDebugConfig ? '编辑接口配置' : '新建接口配置'"></h3>
                </div>
                <form @submit.prevent="saveDebugConfig()" class="p-4 sm:p-6 space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">配置名称</label>
                            <input type="text" x-model="debugConfigForm.name" required
                                   class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">请求方法</label>
                            <select x-model="debugConfigForm.method"
                                    class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                                <option value="PATCH">PATCH</option>
                                <option value="HEAD">HEAD</option>
                                <option value="OPTIONS">OPTIONS</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">描述</label>
                        <textarea x-model="debugConfigForm.description"
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">请求URL</label>
                        <input type="url" x-model="debugConfigForm.url" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">请求头 (JSON格式)</label>
                        <textarea x-model="debugConfigForm.headersText" rows="3"
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 font-mono text-sm"
                                  placeholder='{"Content-Type": "application/json"}'></textarea>
                    </div>
                    <div x-show="['POST', 'PUT', 'PATCH'].includes(debugConfigForm.method)">
                        <label class="block text-sm font-medium text-gray-700">请求体</label>
                        <textarea x-model="debugConfigForm.payload" rows="4"
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 font-mono text-sm"></textarea>
                    </div>

                    <!-- 通知设置 -->
                    <div class="border-t pt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-3">通知设置</h4>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" x-model="debugConfigForm.notification_enabled"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">启用通知</span>
                            </label>
                            <div x-show="debugConfigForm.notification_enabled" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">通知方式</label>
                                    <select x-model="debugConfigForm.notification_type"
                                            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                                        <option value="">选择通知方式</option>
                                        <template x-for="config in notificationConfigs" :key="config.name">
                                            <option :value="config.name" x-text="getNotificationDisplayNameWithAccount(config)"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">通知条件</label>
                                    <select x-model="debugConfigForm.notification_condition"
                                            class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 text-sm">
                                        <option value="always">总是通知</option>
                                        <option value="success">成功时通知</option>
                                        <option value="error">失败时通知</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 定时设置 -->
                    <div class="border-t pt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-3">定时设置</h4>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" x-model="debugConfigForm.is_active"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">启用定时执行</span>
                            </label>
                            <div x-show="debugConfigForm.is_active">
                                <label class="block text-sm font-medium text-gray-700">Cron表达式</label>
                                <input type="text" x-model="debugConfigForm.cron_expression"
                                       class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                       placeholder="例如: 0 */1 * * * (每小时执行)">
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row sm:justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                        <button type="button" @click="showDebugConfigModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 导入请求模态框 -->
    <div x-show="showImportModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showImportModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full relative">
                <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">导入请求</h3>
                    <p class="mt-1 text-sm text-gray-600">支持导入cURL和fetch命令</p>
                </div>
                <form @submit.prevent="importRequest()" class="p-4 sm:p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">请求内容</label>
                        <textarea x-model="importContent" rows="8" required
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 font-mono text-sm"
                                  placeholder="粘贴cURL命令或fetch代码..."></textarea>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-md">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">支持的格式示例：</h4>
                        <div class="text-xs text-gray-600 space-y-1">
                            <p><strong>cURL:</strong> curl -X POST "https://api.example.com" -H "Content-Type: application/json" -d '{"key":"value"}'</p>
                            <p><strong>fetch:</strong> fetch("https://api.example.com", {method: "POST", headers: {"Content-Type": "application/json"}, body: '{"key":"value"}'})</p>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row sm:justify-end space-y-2 sm:space-y-0 sm:space-x-3">
                        <button type="button" @click="showImportModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            导入
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 脚本订阅模态框 -->
    <div x-show="showSubscriptionModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 py-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showSubscriptionModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full relative max-h-[90vh] overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900" x-text="editingSubscription ? '编辑订阅' : '新建订阅'"></h3>
                </div>
                <form @submit.prevent="saveSubscription()" class="p-6 space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">订阅名称 *</label>
                            <input type="text" x-model="subscriptionForm.name" required
                                   class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">保存目录</label>
                            <input type="text" x-model="subscriptionForm.save_directory"
                                   class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                   placeholder="留空自动生成">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">描述</label>
                        <textarea x-model="subscriptionForm.description"
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2" rows="2"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Git仓库URL *</label>
                        <input type="url" x-model="subscriptionForm.git_url" required
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                               placeholder="https://github.com/user/repo.git">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">文件扩展名</label>
                        <input type="text" x-model="subscriptionForm.file_extensions"
                               class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                               placeholder="例如: .py,.js,.txt (留空表示所有文件)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">排除文件/文件夹</label>
                        <textarea x-model="subscriptionForm.exclude_patterns"
                                  class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2" rows="2"
                                  placeholder="例如: .git,.github,node_modules,__pycache__ (用逗号分隔)"></textarea>
                        <p class="mt-1 text-xs text-gray-500">指定要排除的文件和文件夹名称，支持通配符模式</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" x-model="subscriptionForm.include_folders"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">包含文件夹</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" x-model="subscriptionForm.include_subfolders"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">包含子文件夹内容</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" x-model="subscriptionForm.use_proxy"
                                       :disabled="!isProxyAvailable()"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="ml-2 text-sm"
                                      :class="isProxyAvailable() ? 'text-gray-700' : 'text-gray-400 cursor-not-allowed'"
                                      :title="!isProxyAvailable() ? '需要先配置代理并启用才能勾选' : ''">使用代理</span>
                            </label>

                            <label class="flex items-center">
                                <input type="checkbox" x-model="subscriptionForm.sync_delete_removed_files"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">同步删除移除文件</span>
                                <span class="ml-1 text-xs text-gray-500" title="当Git仓库中有文件被删除时，同步删除本地的同名文件">(?)</span>
                            </label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Cron表达式 *</label>
                            <input type="text" x-model="subscriptionForm.cron_expression" required
                                   class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                   placeholder="例如: 0 */6 * * * (每6小时)">
                        </div>
                    </div>

                    <!-- 自动创建任务设置 -->
                    <div class="border-t pt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-3">任务设置</h4>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" x-model="subscriptionForm.auto_create_tasks"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">自动创建任务</span>
                            </label>
                            <div x-show="subscriptionForm.auto_create_tasks" class="text-sm text-gray-600 bg-blue-50 p-3 rounded-md">
                                <p class="mb-2"><i class="fas fa-info-circle mr-1"></i> 启用后将自动为新增的脚本创建任务：</p>
                                <ul class="list-disc list-inside space-y-1 text-xs">
                                    <li>任务名称：订阅名_脚本名</li>
                                    <li>执行时间：每天凌晨3点</li>
                                    <li>任务分组：订阅_订阅名</li>
                                    <li>支持文件：.py（Python）和 .js（JavaScript）</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 通知设置 -->
                    <div class="border-t pt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-3">通知设置</h4>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" x-model="subscriptionForm.notification_enabled"
                                       class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                                <span class="ml-2 text-sm text-gray-700">启用更新通知</span>
                            </label>
                            <div x-show="subscriptionForm.notification_enabled">
                                <label class="block text-sm font-medium text-gray-700">通知方式</label>
                                <select x-model="subscriptionForm.notification_type"
                                        class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                    <option value="">选择通知方式</option>
                                    <template x-for="config in notificationConfigs" :key="config.name">
                                        <option :value="config.name" x-text="getNotificationDisplayNameWithAccount(config)"></option>
                                    </template>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" @click="showSubscriptionModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 代理配置模态框 -->
    <div x-show="showProxyConfigModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showProxyConfigModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full relative">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">代理设置</h3>
                </div>
                <form @submit.prevent="saveProxyConfig()" class="p-6 space-y-4">
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" x-model="proxyConfig.enabled"
                                   class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                            <span class="ml-2 text-sm text-gray-700">启用代理</span>
                        </label>
                    </div>
                    <div x-show="proxyConfig.enabled" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">代理主机</label>
                            <input type="text" x-model="proxyConfig.host"
                                   class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                   placeholder="例如: 127.0.0.1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">代理端口</label>
                            <input type="number" x-model="proxyConfig.port"
                                   class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"
                                   placeholder="例如: 7890">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" @click="showProxyConfigModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            取消
                        </button>
                        <button type="submit"
                                class="px-4 py-2 text-sm font-medium text-white btn-primary rounded-md">
                            保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 订阅日志模态框 -->
    <div x-show="showSubscriptionLogsModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showSubscriptionLogsModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full relative max-h-[90vh] flex flex-col">
                <div class="px-6 py-4 border-b border-gray-200 flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">
                            <span x-text="currentSubscriptionLogs ? currentSubscriptionLogs.name : ''"></span> - 同步日志
                        </h3>
                        <button @click="showSubscriptionLogsModal = false" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto p-6">
                    <div x-show="subscriptionLogsLoading" class="text-center py-8 text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        加载中...
                    </div>
                    <div x-show="!subscriptionLogsLoading && subscriptionLogs.length === 0" class="text-center py-8 text-gray-500">
                        暂无同步日志
                    </div>
                    <div x-show="!subscriptionLogsLoading && subscriptionLogs.length > 0" class="space-y-4">
                        <template x-for="log in subscriptionLogs" :key="log.id">
                            <div class="border border-gray-200 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center space-x-2">
                                        <span :class="log.status === 'success' ? 'bg-green-100 text-green-800' : log.status === 'error' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'"
                                              class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                              x-text="log.status === 'success' ? '成功' : log.status === 'error' ? '失败' : '运行中'">
                                        </span>
                                        <span class="text-sm text-gray-500" x-text="new Date(log.start_time).toLocaleString()"></span>
                                    </div>
                                    <div class="text-sm text-gray-500">
                                        <span x-show="log.files_added > 0">新增: <span x-text="log.files_added"></span></span>
                                        <span x-show="log.files_updated > 0" class="ml-2">更新: <span x-text="log.files_updated"></span></span>
                                    </div>
                                </div>
                                <div class="text-sm text-gray-700" x-text="log.message || '无消息'"></div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- requirements.txt依赖检查模态框 -->
    <div x-show="showRequirementsModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-2 sm:px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showRequirementsModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl w-full max-w-7xl relative max-h-[95vh] flex flex-col">
                <div class="px-4 sm:px-6 py-4 border-b border-gray-200 flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">
                            <i class="fas fa-list-check mr-2"></i>
                            <span class="hidden sm:inline" x-text="currentRequirementsSubscription ? currentRequirementsSubscription.name : ''"></span>
                            <span class="sm:hidden">依赖检查</span>
                            <span class="hidden sm:inline"> - 依赖检查</span>
                        </h3>
                        <button @click="showRequirementsModal = false" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div x-show="requirementsData" class="mt-2 text-sm text-gray-500">
                        <div class="flex flex-wrap gap-2 sm:gap-4">
                            <span>总计: <span x-text="requirementsData ? requirementsData.total_count : 0"></span></span>
                            <span>已安装: <span x-text="requirementsData ? requirementsData.installed_count : 0"></span></span>
                            <span>未安装: <span x-text="requirementsData ? requirementsData.not_installed_count : 0"></span></span>
                        </div>
                    </div>
                    <!-- 进度条 -->
                    <div x-show="requirementsLoading" class="mt-3">
                        <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden relative">
                            <div class="bg-blue-600 h-2 rounded-full progress-bar-animated absolute top-0 left-0"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">正在检查依赖...</div>
                    </div>
                </div>
                <div class="flex-1 overflow-hidden">
                    <div x-show="requirementsLoading" class="flex items-center justify-center h-full">
                        <div class="text-center text-gray-500">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>正在检查依赖...</p>
                        </div>
                    </div>
                    <div x-show="!requirementsLoading && requirementsData" class="h-full overflow-y-auto">
                        <!-- 始终保持左右两栏布局，即使在小屏幕上 -->
                        <div class="grid grid-cols-2 gap-2 sm:gap-4 lg:gap-6 p-2 sm:p-4 lg:p-6">
                            <!-- 左侧：requirements.txt要求 -->
                            <div class="bg-gray-50 rounded-lg p-2 sm:p-4">
                                <h4 class="text-sm sm:text-md font-medium text-gray-900 mb-2 sm:mb-4">
                                    <i class="fas fa-file-alt mr-1 sm:mr-2"></i>
                                    <span class="hidden sm:inline">requirements.txt 要求</span>
                                    <span class="sm:hidden">要求</span>
                                </h4>
                                <div class="space-y-2 sm:space-y-3 max-h-96 overflow-y-auto">
                                    <template x-for="req in (requirementsData ? requirementsData.requirements : [])" :key="req.name">
                                        <div class="bg-white rounded-md p-2 sm:p-3 border border-gray-200">
                                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                                                <div class="min-w-0 flex-1">
                                                    <div class="font-medium text-gray-900 text-xs sm:text-sm truncate" x-text="req.name" :title="req.name"></div>
                                                    <div class="text-xs mt-1 sm:mt-0 sm:ml-2">
                                                        <span x-show="req.operator && req.required_version"
                                                              class="text-gray-600"
                                                              x-text="req.operator + req.required_version"></span>
                                                        <span x-show="!req.operator || !req.required_version"
                                                              class="text-gray-500">未要求版本</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- 右侧：安装状态 -->
                            <div class="bg-gray-50 rounded-lg p-2 sm:p-4">
                                <h4 class="text-sm sm:text-md font-medium text-gray-900 mb-2 sm:mb-4">
                                    <i class="fas fa-check-circle mr-1 sm:mr-2"></i>
                                    <span class="hidden sm:inline">安装状态</span>
                                    <span class="sm:hidden">状态</span>
                                </h4>
                                <div class="space-y-2 sm:space-y-3 max-h-96 overflow-y-auto">
                                    <template x-for="req in (requirementsData ? requirementsData.requirements : [])" :key="req.name">
                                        <div class="bg-white rounded-md p-2 sm:p-3 border border-gray-200">
                                            <div class="flex items-center justify-between">
                                                <div class="min-w-0 flex-1 mr-2">
                                                    <div class="font-medium text-gray-900 text-xs sm:text-sm truncate" x-text="req.name" :title="req.name"></div>
                                                    <div x-show="req.installed_version"
                                                          class="text-xs text-gray-600 mt-0.5"
                                                          x-text="'v' + req.installed_version"></div>
                                                </div>
                                                <div class="flex-shrink-0">
                                                    <span :class="req.status === 'installed' ?
                                                                  (req.status_text === '版本相同' || req.status_text === '已安装' ? 'bg-green-100 text-green-800' :
                                                                   req.status_text === '需要升级' ? 'bg-blue-100 text-blue-800' :
                                                                   req.status_text === '需要降级' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800') :
                                                                  req.status === 'not_installed' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'"
                                                          class="inline-flex px-1 sm:px-2 py-1 text-xs font-semibold rounded-full"
                                                          x-text="req.status_text">
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex-shrink-0">
                    <div class="flex justify-end">
                        <button @click="showRequirementsModal = false"
                                class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                            关闭
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 变量列表模态框 -->
    <div x-show="showVariablesModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showVariablesModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full relative">
                <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">可用变量</h3>
                    <p class="mt-1 text-sm text-gray-600">点击变量名复制到剪贴板</p>
                </div>
                <div class="p-4 sm:p-6">
                    <div class="space-y-3">
                        <template x-for="variable in availableVariables" :key="variable.name">
                            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer"
                                 @click="copyVariableName(variable.name)">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <h4 class="text-sm font-medium text-gray-900" x-text="variable.name"></h4>
                                        <p class="text-sm text-gray-600" x-text="variable.description"></p>
                                        <p class="text-xs text-gray-500 mt-1">示例: <span x-text="variable.example"></span></p>
                                    </div>
                                    <div class="ml-4">
                                        <i class="fas fa-copy text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                <div class="px-4 sm:px-6 py-4 border-t border-gray-200 flex justify-end">
                    <button @click="showVariablesModal = false"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                        关闭
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 数据收集说明模态框 -->
    <div x-show="showDataCollectionModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 py-4">
            <div class="fixed inset-0 bg-black opacity-50" @click="showDataCollectionModal = false"></div>
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full relative max-h-[90vh] overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-medium text-gray-900">数据收集说明</h3>
                        <button @click="showDataCollectionModal = false" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="prose max-w-none">
                        <p class="text-gray-700 mb-4">
                            感谢您使用本项目！本项目为开源软件，<strong>不会主动收集任何个人隐私数据</strong>。为了改进产品质量和提供更好的服务，我们会在以下场景中收集<strong>匿名化的技术统计信息</strong>：
                        </p>

                        <h4 class="text-lg font-semibold text-gray-900 mt-6 mb-3">1. 收集的信息内容</h4>
                        <p class="text-gray-700 mb-3">当您检查版本更新时，系统会向服务器发送以下<strong>非个人身份信息</strong>：</p>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700 mb-4">
                            <li><strong>软件版本号</strong>（您当前使用的Pinchy版本）</li>
                            <li><strong>系统环境信息</strong>：
                                <ul class="list-disc pl-6 mt-2 space-y-1">
                                    <li>操作系统类型及版本（如 Windows 10/macOS 12.5）</li>
                                    <li>Python 版本（如 3.12.1）</li>
                                    <li>Node.js 版本（如 18.20.7）</li>
                                    <li>处理器架构（如 x86_64/ARM）</li>
                                </ul>
                            </li>
                            <li><strong>匿名标识符</strong>：
                                <ul class="list-disc pl-6 mt-2 space-y-1">
                                    <li>系统生成的随机 UUID（每次安装时重新生成，无法关联真实身份）</li>
                                    <li>客户端 IP 地址（仅用于粗略地理位置统计）</li>
                                </ul>
                            </li>
                        </ul>

                        <h4 class="text-lg font-semibold text-gray-900 mt-6 mb-3">2. 信息用途</h4>
                        <p class="text-gray-700 mb-3">收集这些数据仅用于：</p>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700 mb-4">
                            <li>统计各版本的使用占比，确定兼容性优先级</li>
                            <li>分析用户环境分布，指导开发方向</li>
                            <li>判断关键问题的影响范围（如特定系统版本的崩溃问题）</li>
                            <li>生成宏观的全球使用热力图（基于IP国家/城市级别）</li>
                        </ul>

                        <h4 class="text-lg font-semibold text-gray-900 mt-6 mb-3">3. 数据处理方式</h4>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700 mb-4">
                            <li>所有数据会<strong>匿名化存储</strong>（IP地址在24小时内哈希处理）</li>
                            <li>统计数据<strong>不包含任何可追溯个人身份的信息</strong></li>
                            <li>数据保留期限为 12 个月，到期后自动删除</li>
                        </ul>

                        <h4 class="text-lg font-semibold text-gray-900 mt-6 mb-3">4. 隐私承诺</h4>
                        <ul class="list-disc pl-6 space-y-2 text-gray-700 mb-4">
                            <li>我们<strong>不会出售、交易或泄露</strong>这些数据</li>
                            <li>统计数据仅以聚合形式用于项目改进（如版本分布图表）</li>
                            <li>完整数据收集逻辑可在<a href="https://github.com/3iXi/Pinchy" target="_blank" class="text-blue-600 hover:text-blue-800 underline">代码仓库</a>中查看项目源代码</li>
                        </ul>

                        <hr class="my-6 border-gray-200">

                        <h4 class="text-lg font-semibold text-gray-900 mb-3">补充信息</h4>
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                            <p class="text-blue-800 text-sm">
                                <strong>对于 UUID 的特别说明：</strong><br>
                                <em>"随机生成的 UUID 仅用于区分不同设备，卸载重装后会生成新标识符，无法用于追踪长期用户行为"</em>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end">
                    <button @click="showDataCollectionModal = false"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md">
                        我已了解
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 全局任务分组下拉菜单（任务管理页任务分组专用，防止浏览器使用纵向进度条遮挡下拉选项） -->
    <div x-show="activeGroupDropdown"
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="transform opacity-0 scale-95"
         x-transition:enter-end="transform opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="transform opacity-100 scale-100"
         x-transition:leave-end="transform opacity-0 scale-95"
         class="fixed bg-white rounded-lg shadow-lg border border-gray-200 z-[9999] w-32"
         :style="'top: ' + groupDropdownPosition.top + 'px; left: ' + groupDropdownPosition.left + 'px;'">
        <div class="py-1">
            <button @click="showRenameGroupModal(activeGroupDropdown)"
                    class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center">
                <i class="fas fa-edit mr-2"></i>
                重命名
            </button>
            <button @click="showDeleteGroupModal(activeGroupDropdown)"
                    class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center">
                <i class="fas fa-trash mr-2"></i>
                删除
            </button>
        </div>
    </div>

    <script src="/static/js/app.js?v=1.2"></script><!-- app.js增加版本号是因为防止缓存导致数据显示错误，增加版本号可以强制浏览器刷新使用新版本 -->
</body>
</html>
